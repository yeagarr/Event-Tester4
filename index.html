<!doctype html>
<html lang="id">
<head>
  <!-- =========================
    BLOK 1 ‚Äî META / SEO / PWA-LITE
  ========================== -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="color-scheme" content="dark light" />
  <meta name="theme-color" content="#0b0613" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>Angpao Keberuntungan 2026</title>
  <meta name="description" content="Event harian: buka 1 angpao, claim freebet, bagikan ke WA. Reset 00:00 WIB." />

  <!-- =========================
    BLOK 2 ‚Äî FONTS
  ========================== -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">

  <style>
    /* =========================
      BLOK 3 ‚Äî THEME TOKENS (ANGPAO 2026)
    ========================== */
    :root{
      --bg0:#07040e;
      --bg1:#0b0613;

      --glass: rgba(255,255,255,.08);
      --stroke: rgba(255,255,255,.14);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.66);

      --red:#ff2f3f;
      --red2:#b1121c;

      --gold:#ffd36e;
      --gold2:#f7b22f;
      --amber:#ffcc66;

      --shadow: 0 18px 60px rgba(0,0,0,.55);
      --shadow2: 0 10px 30px rgba(0,0,0,.45);
      --radius: 22px;

      --easeOut: cubic-bezier(.2,.9,.2,1);
      --easeSoft: cubic-bezier(.22,.8,.22,1);
      --easePop: cubic-bezier(.18,1.08,.24,1);
      --easeSnappy: cubic-bezier(.2,1,.2,1);

      --ring: rgba(255,211,110,.42);

      --safeT: env(safe-area-inset-top, 0px);
      --safeB: env(safe-area-inset-bottom, 0px);
      --safeL: env(safe-area-inset-left, 0px);
      --safeR: env(safe-area-inset-right, 0px);
    }

    /* =========================
      BLOK 4 ‚Äî RESET / BASE
    ========================== */
    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 20% 10%, rgba(255,47,63,.18), transparent 60%),
        radial-gradient(900px 520px at 85% 25%, rgba(255,211,110,.16), transparent 55%),
        radial-gradient(900px 720px at 55% 95%, rgba(160,120,255,.10), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
      padding: var(--safeT) var(--safeR) var(--safeB) var(--safeL);
    }
    a{ color:inherit; text-decoration:none; }
    button, input{ font: inherit; color: inherit; }
    button{ -webkit-tap-highlight-color: transparent; }
    :where(button, [role="button"], input){ touch-action: manipulation; }

    .wrap{
      min-height:100%;
      display:grid;
      place-items:center;
      padding: calc(26px + var(--safeT)) 18px calc(40px + var(--safeB));
    }

    /* =========================
      BLOK 5 ‚Äî BACKDROP NOISE + SPARKS (lebih lembut + stabil)
    ========================== */
    .noise{
      pointer-events:none;
      position:fixed; inset:0;
      opacity:.10;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='260' height='260'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.7' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='260' height='260' filter='url(%23n)' opacity='.35'/%3E%3C/svg%3E");
      mix-blend-mode: overlay;
    }
    .sparks{
      pointer-events:none;
      position:fixed; inset:-20%;
      background:
        radial-gradient(circle at 20% 30%, rgba(255,211,110,.10), transparent 35%),
        radial-gradient(circle at 80% 40%, rgba(255,47,63,.09), transparent 34%),
        radial-gradient(circle at 50% 75%, rgba(255,255,255,.06), transparent 36%);
      animation: drift 14s var(--easeSoft) infinite alternate;
      filter: blur(18px) saturate(1.25);
      opacity:.92;
      will-change: transform;
    }
    @keyframes drift{
      0%{ transform: translate3d(-1.2%, -1.1%, 0) scale(1.02); }
      100%{ transform: translate3d(1.4%, 1.2%, 0) scale(1.06); }
    }

    /* =========================
      BLOK 6 ‚Äî CARD LAYOUT (edge glow lebih premium)
    ========================== */
    .card{
      width:min(980px, 100%);
      border:1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      overflow:hidden;
      position:relative;
      backdrop-filter: blur(18px) saturate(1.25);
      -webkit-backdrop-filter: blur(18px) saturate(1.25);
      isolation:isolate;
    }
    .card::before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(600px 260px at 18% 10%, rgba(255,47,63,.22), transparent 55%),
        radial-gradient(540px 280px at 85% 15%, rgba(255,211,110,.18), transparent 55%);
      opacity:.75;
      filter: blur(1px);
      pointer-events:none;
      z-index:0;
    }
    .card::after{
      content:"";
      position:absolute; inset:0;
      pointer-events:none;
      background: linear-gradient(180deg, rgba(255,255,255,.10), transparent 30%, rgba(0,0,0,.14));
      opacity:.35;
      z-index:0;
    }

    .head{
      position:relative;
      padding: 22px 22px 0;
      display:flex;
      gap:16px;
      align-items:flex-start;
      justify-content:space-between;
      flex-wrap:wrap;
      z-index:1;
    }
    .titleWrap{ min-width: 240px; }
    h1{
      margin:0;
      font-size: clamp(22px, 2.6vw, 32px);
      letter-spacing: .2px;
    }
    .sub{
      margin:8px 0 0;
      color:var(--muted);
      line-height:1.45;
      font-size: 13.5px;
      max-width: 64ch;
    }

    .pillRow{
      display:flex; gap:10px; flex-wrap:wrap;
      align-items:center; justify-content:flex-end;
    }
    .pill{
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.18);
      padding: 9px 12px;
      border-radius: 999px;
      display:flex; gap:10px; align-items:center;
      box-shadow: var(--shadow2);
      backdrop-filter: blur(10px) saturate(1.2);
      -webkit-backdrop-filter: blur(10px) saturate(1.2);
    }
    .pill b{ font-size: 12.5px; letter-spacing:.2px; }
    .pill span{ font-size: 12px; color: var(--muted); }

    .grid{
      position:relative;
      padding: 18px 22px 22px;
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap: 16px;
      align-items:stretch;
      z-index:1;
    }
    @media (max-width: 860px){
      .grid{ grid-template-columns: 1fr; }
      .pillRow{ justify-content:flex-start; }
      .head{ padding: 20px 18px 0; }
      .grid{ padding: 16px 18px 18px; }
    }

    .pane{
      border:1px solid var(--stroke);
      background: rgba(8,6,14,.35);
      border-radius: 18px;
      box-shadow: var(--shadow2);
      position:relative;
      overflow:hidden;
    }
    .paneInner{ padding: 16px; position:relative; }

    /* =========================
      BLOK 7 ‚Äî INPUT / BUTTONS (lebih responsif + press feel)
    ========================== */
    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .label{ font-size: 12px; color: var(--muted); }

    .input{
      flex:1; min-width: 220px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.14);
      background:
        radial-gradient(120px 80px at 20% 0%, rgba(255,211,110,.10), transparent 60%),
        rgba(255,255,255,.06);
      padding: 11px 12px;
      outline:none;
      transition: transform .18s var(--easeOut), border-color .18s var(--easeOut), box-shadow .18s var(--easeOut);
    }
    .input:focus{
      border-color: rgba(255,211,110,.45);
      box-shadow: 0 0 0 4px rgba(255,211,110,.12);
      transform: translateY(-1px);
    }

    .btn{
      border:1px solid rgba(255,255,255,.18);
      background:
        radial-gradient(120px 60px at 20% 0%, rgba(255,255,255,.12), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.08));
      padding: 11px 14px;
      border-radius: 14px;
      cursor:pointer;
      transition: transform .18s var(--easeOut), filter .18s var(--easeOut), box-shadow .18s var(--easeOut);
      box-shadow: 0 10px 22px rgba(0,0,0,.35);
      user-select:none;
      position:relative;
      overflow:hidden;
      will-change: transform;
    }
    .btn::after{
      content:"";
      position:absolute; inset:-1px;
      background: linear-gradient(120deg, transparent 35%, rgba(255,255,255,.14), transparent 65%);
      transform: translateX(-60%);
      opacity:0;
      transition: transform .6s var(--easeSoft), opacity .2s var(--easeOut);
      pointer-events:none;
    }
    .btn:hover::after{ opacity:.9; transform: translateX(65%); }
    .btn:hover{ transform: translateY(-1px); filter: brightness(1.06); }
    .btn:active{ transform: translateY(0px) scale(.985); filter: brightness(1.02); }
    .btn:focus-visible{
      outline:none;
      box-shadow: 0 0 0 4px rgba(255,211,110,.14), 0 10px 22px rgba(0,0,0,.35);
    }

    .btnPrimary{
      border-color: rgba(255,211,110,.35);
      background:
        radial-gradient(160px 80px at 30% 0%, rgba(255,211,110,.22), transparent 60%),
        linear-gradient(180deg, rgba(255,211,110,.18), rgba(255,47,63,.12));
    }
    .btnDanger{
      border-color: rgba(255,47,63,.35);
      background:
        radial-gradient(160px 80px at 30% 0%, rgba(255,47,63,.22), transparent 60%),
        linear-gradient(180deg, rgba(255,47,63,.18), rgba(0,0,0,.12));
    }
    .btnGhost{ background: transparent; box-shadow:none; }
    .btn[disabled]{
      opacity:.55;
      cursor:not-allowed;
      filter: grayscale(.1);
      transform:none !important;
    }

    .mini{
      font-size: 12px;
      color: var(--muted);
      line-height:1.5;
      margin-top: 10px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .tag{
      border:1px solid rgba(255,255,255,.13);
      background: rgba(255,255,255,.06);
      padding: 6px 10px;
      border-radius: 999px;
    }

    /* =========================
      BLOK 8 ‚Äî STAGE (lebih adaptif untuk mobile)
    ========================== */
    .stage{
      display:grid;
      place-items:center;
      min-height: clamp(320px, 48vh, 420px);
      padding: 14px 12px 18px;
      position:relative;
      border-radius: 16px;
      background:
        radial-gradient(380px 220px at 50% 38%, rgba(255,47,63,.10), transparent 62%),
        radial-gradient(420px 260px at 50% 55%, rgba(255,211,110,.08), transparent 66%);
      overflow:hidden;
    }
    .stage::before{
      content:"";
      position:absolute; inset:-40%;
      background: conic-gradient(from 180deg at 50% 50%,
        rgba(255,211,110,.10),
        rgba(255,47,63,.08),
        rgba(255,255,255,.05),
        rgba(255,47,63,.07),
        rgba(255,211,110,.10));
      filter: blur(38px);
      opacity:.35;
      animation: stageGlow 9s var(--easeSoft) infinite alternate;
      pointer-events:none;
      will-change: transform;
    }
    .stage::after{
      content:"";
      position:absolute; inset:-10%;
      background:
        radial-gradient(circle at 15% 20%, rgba(255,211,110,.08), transparent 28%),
        radial-gradient(circle at 85% 25%, rgba(255,47,63,.07), transparent 30%),
        radial-gradient(circle at 50% 80%, rgba(255,255,255,.06), transparent 32%);
      filter: blur(18px);
      opacity:.65;
      pointer-events:none;
      animation: stageMist 11s var(--easeSoft) infinite alternate;
      will-change: transform;
    }
    @keyframes stageGlow{
      0%{ transform: translate3d(-1%, -1%, 0) rotate(-6deg) scale(1.02); }
      100%{ transform: translate3d(1%, 1%, 0) rotate(6deg) scale(1.06); }
    }
    @keyframes stageMist{
      0%{ transform: translate3d(-.8%, .4%, 0) scale(1.01); }
      100%{ transform: translate3d(.9%, -.6%, 0) scale(1.04); }
    }

    /* =========================
      BLOK 9 ‚Äî ANGPAO 3D (MODERN + Opening keyframes lebih ‚Äúniat‚Äù)
    ========================== */
    .angpaoWrap{
      position:relative;
      width: min(460px, 100%);
      display:grid;
      gap: 14px;
      justify-items:center;
      z-index: 2;
    }

    .angpao{
      --rx: 0deg;
      --ry: 0deg;
      --lift: 0px;
      --shineX: 20%;
      --shineY: 0%;
      width: min(360px, 92vw);
      aspect-ratio: 340 / 230;
      height: auto;
      position:relative;
      transform-style:preserve-3d;
      transform:
        perspective(950px)
        translateY(var(--lift))
        rotateX(var(--rx))
        rotateY(var(--ry));
      transition: transform .35s var(--easeOut), filter .35s var(--easeOut);
      filter: drop-shadow(0 24px 55px rgba(0,0,0,.55));
      user-select:none;
      cursor:pointer;
      outline:none;
      will-change: transform, filter;
    }

    .angpaoIdle{
      animation: floaty 3.8s var(--easeSoft) infinite;
    }
    @keyframes floaty{
      0%{ transform: perspective(950px) translateY(0px) rotateX(var(--rx)) rotateY(var(--ry)); }
      50%{ transform: perspective(950px) translateY(-6px) rotateX(calc(var(--rx) - 1deg)) rotateY(calc(var(--ry) + 1deg)); }
      100%{ transform: perspective(950px) translateY(0px) rotateX(var(--rx)) rotateY(var(--ry)); }
    }

    .angpao:hover{
      --lift: -4px;
      filter: drop-shadow(0 28px 70px rgba(0,0,0,.62));
    }
    .angpao:active{
      --lift: -1px;
      transform: perspective(950px) translateY(var(--lift)) rotateX(var(--rx)) rotateY(var(--ry)) scale(.992);
    }

    .angpao.envDisabled{
      cursor:not-allowed;
      opacity:.78;
      filter: grayscale(.12) saturate(.9) drop-shadow(0 18px 42px rgba(0,0,0,.5));
    }

    /* Base body */
    .angpao__body{
      position:absolute; inset:0;
      border-radius: 22px;
      background: linear-gradient(180deg, rgba(255,47,63,.95), rgba(177,18,28,.92));
      border: 1px solid rgba(255,255,255,.18);
      overflow:hidden;
      transform: translateZ(0);
    }
    /* Foil border */
    .angpao__body::before{
      content:"";
      position:absolute; inset:10px;
      border-radius: 18px;
      border: 1px solid rgba(255,211,110,.25);
      box-shadow:
        inset 0 0 0 1px rgba(255,211,110,.10),
        inset 0 0 18px rgba(255,211,110,.10);
      opacity:.85;
      pointer-events:none;
    }
    /* Inner shading */
    .angpao__innerShade{
      position:absolute; inset:0;
      background:
        radial-gradient(340px 220px at 40% 0%, rgba(255,255,255,.10), transparent 62%),
        radial-gradient(360px 260px at 60% 95%, rgba(0,0,0,.32), transparent 66%);
      mix-blend-mode: overlay;
      opacity:.9;
      pointer-events:none;
    }
    /* Subtle pattern */
    .angpao__pattern{
      position:absolute; inset:-30%;
      background:
        radial-gradient(circle at 15% 25%, rgba(255,211,110,.16), transparent 26%),
        radial-gradient(circle at 75% 35%, rgba(255,255,255,.08), transparent 24%),
        radial-gradient(circle at 45% 78%, rgba(255,211,110,.12), transparent 26%),
        repeating-linear-gradient(45deg, rgba(255,255,255,.05) 0 1px, transparent 1px 12px);
      opacity:.42;
      transform: rotate(8deg);
      mix-blend-mode: screen;
      pointer-events:none;
    }

    /* Pocket folds */
    .angpao__pocket{
      position:absolute; left:0; right:0; bottom:0;
      height: 72%;
      pointer-events:none;
    }
    .angpao__pocket::before{
      content:"";
      position:absolute; inset:0;
      background:
        linear-gradient(180deg, rgba(0,0,0,.00), rgba(0,0,0,.18)),
        linear-gradient(90deg, rgba(0,0,0,.18), rgba(0,0,0,.00) 20%, rgba(0,0,0,.00) 80%, rgba(0,0,0,.18));
      opacity:.55;
    }
    .angpao__pocket::after{
      content:"";
      position:absolute; inset:-4px 0 0;
      background:
        linear-gradient(90deg,
          transparent 0 21%,
          rgba(255,255,255,.08) 21% 22%,
          transparent 22% 78%,
          rgba(255,255,255,.08) 78% 79%,
          transparent 79% 100%);
      opacity:.55;
    }

    /* Foil shine (moves with pointer) */
    .angpao__shine{
      position:absolute; inset:-2px;
      background:
        radial-gradient(240px 160px at var(--shineX) var(--shineY),
          rgba(255,211,110,.36), transparent 62%),
        linear-gradient(120deg, transparent 35%, rgba(255,255,255,.10), transparent 65%);
      mix-blend-mode: screen;
      opacity:.62;
      filter: blur(0.2px);
      pointer-events:none;
      transition: opacity .25s var(--easeOut);
    }
    .angpao:hover .angpao__shine{ opacity:.92; }

    /* Flap */
    .angpao__flap{
      position:absolute; left:0; right:0; top:-2px;
      height: 58%;
      transform-origin: 50% 0%;
      transform: translateZ(16px) rotateX(0deg);
      z-index: 5;
      will-change: transform;
    }
    .angpao__flap::before{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(220px 120px at 50% 0%, rgba(255,255,255,.12), transparent 62%),
        linear-gradient(180deg, rgba(255,80,90,.96), rgba(170,14,22,.95));
      clip-path: polygon(0 0, 100% 0, 50% 100%);
      border-top-left-radius: 22px;
      border-top-right-radius: 22px;
      border: 1px solid rgba(255,255,255,.16);
      border-bottom: none;
      box-shadow: 0 18px 30px rgba(0,0,0,.18);
    }
    .angpao__flap::after{
      content:"";
      position:absolute; inset:0;
      clip-path: polygon(0 0, 100% 0, 50% 100%);
      background: linear-gradient(180deg, rgba(0,0,0,.20), transparent 60%);
      opacity:.55;
      pointer-events:none;
    }

    /* Seal (golden wax) */
    .angpao__seal{
      position:absolute;
      left:50%; top:54%;
      transform: translate(-50%,-50%) translateZ(22px);
      width: 68px; height: 68px;
      border-radius: 999px;
      background:
        radial-gradient(circle at 30% 28%, rgba(255,255,255,.22), transparent 45%),
        radial-gradient(circle at 70% 78%, rgba(0,0,0,.22), transparent 55%),
        linear-gradient(180deg, rgba(255,211,110,.96), rgba(247,178,47,.96));
      border: 1px solid rgba(255,255,255,.22);
      box-shadow: 0 14px 26px rgba(0,0,0,.42);
      display:grid;
      place-items:center;
      font-weight: 900;
      letter-spacing:.6px;
      color: rgba(20,10,10,.86);
      z-index: 6;
      transition: opacity .25s var(--easeOut);
      will-change: transform, opacity;
    }
    .angpao__seal small{
      display:block;
      font-weight:800;
      font-size: 11px;
      opacity:.92;
      transform: translateY(1px);
    }
    .angpao__seal::after{
      content:"";
      position:absolute; inset:-2px;
      border-radius: 999px;
      background: conic-gradient(from 180deg, rgba(255,255,255,.10), transparent 35%, rgba(255,255,255,.10));
      mix-blend-mode: overlay;
      opacity:.55;
      pointer-events:none;
    }

    /* Letter wrapper (comes out from pocket) */
    .angpao__letter{
      position:absolute;
      left: 14px; right: 14px;
      bottom: 12px;
      height: 76%;
      transform: translateY(34px) translateZ(10px);
      z-index: 3;
      opacity: .98;
      will-change: transform;
    }

    .letterCard{
      height:100%;
      border-radius: 18px;
      background:
        radial-gradient(180px 120px at 20% 10%, rgba(255,211,110,.18), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.96), rgba(255,255,255,.90));
      border: 1px solid rgba(0,0,0,.08);
      box-shadow: 0 18px 35px rgba(0,0,0,.25);
      overflow:hidden;
      position:relative;
    }
    .letterCard::before{
      content:"";
      position:absolute; inset:-40%;
      background:
        radial-gradient(circle at 18% 22%, rgba(255,211,110,.24), transparent 40%),
        radial-gradient(circle at 80% 70%, rgba(255,47,63,.16), transparent 45%);
      transform: rotate(10deg);
      opacity:.9;
    }
    .letterTopbar{
      position:relative;
      padding: 10px 12px 8px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      border-bottom: 1px dashed rgba(0,0,0,.10);
      color: rgba(20,10,10,.70);
      font-weight: 800;
      font-size: 12px;
      letter-spacing:.2px;
    }
    .chip{
      border: 1px solid rgba(0,0,0,.10);
      background: rgba(255,255,255,.65);
      padding: 6px 10px;
      border-radius: 999px;
      display:flex; align-items:center; gap:8px;
      box-shadow: 0 10px 18px rgba(0,0,0,.10);
    }
    .chip i{
      width:10px; height:10px; border-radius:999px;
      background: linear-gradient(180deg, rgba(255,211,110,.95), rgba(247,178,47,.95));
      box-shadow: 0 6px 10px rgba(0,0,0,.12);
      display:inline-block;
    }

    .letterMain{
      position:relative;
      height: calc(100% - 42px);
      display:grid;
      place-items:center;
      padding: 14px 16px 16px;
      color: #140a0a;
      text-align:center;
    }
    .amount{
      font-size: clamp(34px, 5.2vw, 44px);
      font-weight: 900;
      letter-spacing: .2px;
      margin: 4px 0 10px;
      line-height:1.0;
    }
    .hint{
      font-size: 12.8px;
      color: rgba(20,10,10,.70);
      line-height:1.45;
      max-width: 38ch;
      margin: 0 auto;
    }
    .subline{
      margin-top: 10px;
      font-size: 12px;
      color: rgba(20,10,10,.55);
    }

    /* Tiny ‚Äústatus pulse‚Äù */
    .pulseDot{
      width: 8px; height: 8px; border-radius: 999px;
      background: rgba(255,47,63,.85);
      box-shadow: 0 0 0 0 rgba(255,47,63,.30);
      animation: pulse 1.6s var(--easeOut) infinite;
    }
    @keyframes pulse{
      0%{ box-shadow: 0 0 0 0 rgba(255,47,63,.30); }
      70%{ box-shadow: 0 0 0 10px rgba(255,47,63,.00); }
      100%{ box-shadow: 0 0 0 0 rgba(255,47,63,.00); }
    }

    /* Opening keyframes (lebih sinkron, terlihat ‚Äúcerdas‚Äù) */
    @keyframes sealPop {
      0%   { transform: translate(-50%,-50%) translateZ(22px) scale(1) rotate(0deg); opacity:1; filter: blur(0); }
      55%  { transform: translate(-50%,-54%) translateZ(22px) scale(1.06) rotate(8deg); opacity:1; }
      100% { transform: translate(-50%,-50%) translateZ(22px) scale(.25) rotate(18deg); opacity:0; filter: blur(.35px); }
    }
    @keyframes flapFlip {
      0%   { transform: translateZ(16px) rotateX(0deg); }
      65%  { transform: translateZ(16px) rotateX(166deg); }
      100% { transform: translateZ(16px) rotateX(170deg); }
    }
    @keyframes letterRise {
      0%   { transform: translateY(34px) translateZ(10px); }
      70%  { transform: translateY(-38px) translateZ(10px); }
      100% { transform: translateY(-34px) translateZ(10px); }
    }

    /* OPEN STATES */
    .isOpening .angpao__seal{ animation: sealPop 650ms var(--easeSnappy) forwards; }
    .isOpening .angpao__flap{ animation: flapFlip 900ms var(--easePop) forwards; }
    .isOpening .angpao__letter{ animation: letterRise 950ms var(--easePop) forwards; }

    .isOpen .angpao__flap{ transform: translateZ(16px) rotateX(170deg); }
    .isOpen .angpao__letter{ transform: translateY(-34px) translateZ(10px); }
    .isOpen .angpao__seal{ opacity:0; }

    /* =========================
      BLOK 10 ‚Äî CTA ROW
    ========================== */
    .ctaRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:center;
      margin-top: 6px;
    }

    /* =========================
      BLOK 11 ‚Äî TIER PANEL
    ========================== */
    .tierTitle{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom: 12px;
    }
    .tierTitle h2{
      margin:0;
      font-size: 14px;
      letter-spacing:.2px;
    }
    .tierTitle .tz{
      font-size: 12px;
      color: var(--muted);
    }

    .tierList{ display:grid; gap: 10px; }
    .tier{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      border-radius: 16px;
      padding: 10px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
    }
    .tier b{ font-size: 13px; letter-spacing:.2px; }
    .tier span{ font-size: 12px; color: var(--muted); }

    .bar{
      height: 8px;
      border-radius: 999px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.12);
      overflow:hidden;
      flex: 1;
      max-width: 260px;
    }
    .bar i{
      display:block;
      height:100%;
      width: var(--w, 30%);
      background: linear-gradient(90deg, rgba(255,211,110,.65), rgba(255,47,63,.55));
      border-radius: 999px;
    }

    /* =========================
      BLOK 12 ‚Äî TOAST / MODAL (transisi halus)
    ========================== */
    .toast{
      position: fixed;
      left: 50%;
      bottom: calc(18px + var(--safeB));
      transform: translateX(-50%) translateY(8px);
      background: rgba(0,0,0,.62);
      border: 1px solid rgba(255,255,255,.14);
      backdrop-filter: blur(16px) saturate(1.2);
      -webkit-backdrop-filter: blur(16px) saturate(1.2);
      padding: 10px 12px;
      border-radius: 999px;
      box-shadow: var(--shadow2);
      display:flex;
      gap:10px;
      align-items:center;
      opacity:0;
      pointer-events:none;
      transition: opacity .18s var(--easeOut), transform .18s var(--easeOut);
      font-size: 12.5px;
      color: rgba(255,255,255,.90);
      z-index: 80;
    }
    .toast.show{
      opacity:1;
      transform: translateX(-50%) translateY(0px);
    }

    .modalBack{
      position:fixed; inset:0;
      background: rgba(0,0,0,.55);
      display:grid;
      place-items:center;
      padding: 18px;
      z-index: 90;

      opacity:0;
      visibility:hidden;
      pointer-events:none;
      transition: opacity .2s var(--easeOut), visibility .2s var(--easeOut);
    }
    .modalBack.show{
      opacity:1;
      visibility:visible;
      pointer-events:auto;
    }

    .modal{
      width: min(720px, 100%);
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(15,10,25,.85);
      backdrop-filter: blur(18px) saturate(1.2);
      -webkit-backdrop-filter: blur(18px) saturate(1.2);
      box-shadow: var(--shadow);
      overflow:hidden;
      transform: translateY(10px) scale(.985);
      transition: transform .22s var(--easeOut);
      will-change: transform;
    }
    .modalBack.show .modal{ transform: translateY(0) scale(1); }

    .modalHead{
      padding: 14px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      border-bottom: 1px solid rgba(255,255,255,.12);
    }
    .modalHead b{ font-size: 13.5px; letter-spacing:.2px; }
    .modalBody{
      padding: 14px 16px 16px;
      color: rgba(255,255,255,.86);
      font-size: 13px;
      line-height:1.55;
    }
    .modalBody ul{ margin: 10px 0 0 18px; }
    .modalBody li{ margin: 6px 0; }

    /* =========================
      BLOK 13 ‚Äî CONFETTI CANVAS (MINI)
    ========================== */
    canvas#confetti{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      pointer-events:none;
      opacity:0;
      transition: opacity .25s var(--easeOut);
      z-index:2;
    }
    .confettiOn{ opacity: 1; }

    /* =========================
      BLOK 14 ‚Äî FOOTER
    ========================== */
    .footer{
      margin-top: 14px;
      color: rgba(255,255,255,.55);
      font-size: 12px;
      line-height:1.5;
      padding: 0 4px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:space-between;
      align-items:center;
      position:relative;
      z-index:1;
    }
    .footer .right{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .linkBtn{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      padding: 7px 10px;
      border-radius: 999px;
      cursor:pointer;
      transition: transform .18s var(--easeOut), filter .18s var(--easeOut);
    }
    .linkBtn:hover{ transform: translateY(-1px); filter: brightness(1.06); }
    .linkBtn:active{ transform: translateY(0) scale(.99); }
    .linkBtn:focus-visible{ outline:none; box-shadow: 0 0 0 4px rgba(255,211,110,.12); }

    @media (max-width: 420px){
      .pill{ width:100%; justify-content:space-between; }
      .input{ min-width: 100%; }
      .btn{ width:auto; }
      .paneInner{ padding: 14px; }
    }

    /* Reduce motion */
    @media (prefers-reduced-motion: reduce){
      .sparks, .stage::before, .stage::after{ animation:none !important; }
      .btn, .toast, .angpao, .angpao__flap, .angpao__letter, .angpao__seal{ transition:none !important; }
      .angpaoIdle{ animation:none !important; }
      .pulseDot{ animation:none !important; }
      .isOpening .angpao__seal,
      .isOpening .angpao__flap,
      .isOpening .angpao__letter{ animation:none !important; }
    }
  </style>
</head>
<body>
  <div class="sparks" aria-hidden="true"></div>
  <div class="noise" aria-hidden="true"></div>

  <div class="wrap">
    <div class="card" role="application" aria-label="Angpao Keberuntungan 2026">
      <canvas id="confetti"></canvas>

      <div class="head">
        <div class="titleWrap">
          <h1>üßß Angpao Keberuntungan 2026</h1>
          <p class="sub">
            Buka <b>1 angpao per hari</b> untuk dapat Freebet sesuai tier. Setelah claim, kamu bisa bagikan ke WhatsApp.
            <span style="display:block;margin-top:6px;color:rgba(255,255,255,.55);font-size:12px">
              Reset: <b>00:00 WIB</b> ‚Ä¢ Mode: <span id="modeLabel">DEMO</span> ‚Ä¢ Seed Commit: <span id="commitHash">‚Äî</span>
            </span>
          </p>
        </div>

        <div class="pillRow">
          <div class="pill" title="Waktu tersisa sebelum reset">
            <b>Reset dalam</b>
            <span id="countdown">‚Äî</span>
          </div>
          <div class="pill" title="Counter ini demo (local). Untuk angka global, pakai API server.">
            <b>Dibuka hari ini</b>
            <span id="openedToday">‚Äî</span>
          </div>
          <div class="pill" title="Counter ini demo (local). Untuk angka global, pakai API server.">
            <b>Dibagikan hari ini</b>
            <span id="sharedToday">‚Äî</span>
          </div>
        </div>
      </div>

      <div class="grid">
        <!-- PANE KIRI -->
        <div class="pane">
          <div class="paneInner">
            <div class="row" style="justify-content:space-between; align-items:flex-end;">
              <div style="flex:1; min-width:260px">
                <div class="label">Username (wajib, untuk seed harian)</div>
                <div class="row" style="margin-top:8px">
                  <input id="username" class="input" placeholder="contoh: garr123" autocomplete="off" spellcheck="false" />
                  <button id="saveUser" class="btn btnPrimary">Simpan</button>
                  <button id="resetAll" class="btn btnGhost" title="Reset demo local (hapus penyimpanan)">Reset</button>
                </div>
                <div class="mini">
                  <span class="tag">Sisa kesempatan hari ini: <b id="chances">‚Äî</b></span>
                  <span class="tag">Status: <b id="statusText">Butuh username</b></span>
                </div>
              </div>
            </div>

            <div class="stage" aria-label="Area Angpao">
              <div class="angpaoWrap">
                <div id="angpao" class="angpao angpaoIdle envDisabled" role="button" tabindex="0" aria-label="Klik untuk membuka angpao">
                  <div class="angpao__body">
                    <div class="angpao__innerShade"></div>
                    <div class="angpao__pattern"></div>
                    <div class="angpao__pocket"></div>
                    <div class="angpao__shine"></div>
                  </div>

                  <div class="angpao__flap"></div>

                  <div class="angpao__seal" aria-hidden="true">
                    <div>2026<small>ANGPAO</small></div>
                  </div>

                  <div class="angpao__letter" aria-hidden="true">
                    <div class="letterCard">
                      <div class="letterTopbar">
                        <span style="display:flex;align-items:center;gap:10px">
                          <span class="pulseDot" aria-hidden="true"></span>
                          HASIL ANGPAO HARI INI
                        </span>
                        <span class="chip"><i aria-hidden="true"></i><span id="tierLabelMini">Tier</span></span>
                      </div>
                      <div class="letterMain">
                        <div>
                          <div class="amount" id="resultAmount">Rp‚Äî</div>
                          <div class="hint" id="resultHint">Klik ‚ÄúBuka Angpao‚Äù untuk melihat hasil. Setelah itu kamu bisa claim freebet.</div>
                          <div class="subline" id="resultSub">1x/hari ‚Ä¢ tidak ada kupon ‚Ä¢ freebet aktif 24 jam</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="ctaRow">
                  <button id="openBtn" class="btn btnDanger" disabled>Buka Angpao</button>
                  <button id="claimBtn" class="btn btnPrimary" disabled>Claim Freebet</button>
                  <button id="shareBtn" class="btn" disabled>Bagikan ke WhatsApp</button>
                </div>

                <div class="mini" style="justify-content:center; text-align:center">
                  <span class="tag">Opening: seal ‚Üí flap ‚Üí letter (keyframes)</span>
                  <span class="tag">Desktop: hover untuk efek 3D</span>
                </div>
              </div>
            </div>

          </div>
        </div>

        <!-- PANE KANAN -->
        <div class="pane">
          <div class="paneInner">
            <div class="tierTitle">
              <h2>Tier Freebet (Distribusi Hadiah)</h2>
              <div class="tz">Zona reset: WIB (Asia/Jakarta)</div>
            </div>

            <div class="tierList" aria-label="Daftar tier freebet">
              <div class="tier">
                <div><b>60% ‚Ä¢ Rp5.000 ‚Äì Rp8.000</b><br><span>Paling sering keluar</span></div>
                <div class="bar" aria-hidden="true"><i style="--w:60%"></i></div>
              </div>
              <div class="tier">
                <div><b>25% ‚Ä¢ Rp9.000 ‚Äì Rp15.000</b><br><span>Sering</span></div>
                <div class="bar" aria-hidden="true"><i style="--w:25%"></i></div>
              </div>
              <div class="tier">
                <div><b>10% ‚Ä¢ Rp16.000 ‚Äì Rp30.000</b><br><span>Menengah</span></div>
                <div class="bar" aria-hidden="true"><i style="--w:10%"></i></div>
              </div>
              <div class="tier">
                <div><b>4% ‚Ä¢ Rp31.000 ‚Äì Rp50.000</b><br><span>Jarang</span></div>
                <div class="bar" aria-hidden="true"><i style="--w:4%"></i></div>
              </div>
              <div class="tier">
                <div><b>1% ‚Ä¢ Rp51.000 ‚Äì Rp100.000</b><br><span>Rare</span></div>
                <div class="bar" aria-hidden="true"><i style="--w:1%"></i></div>
              </div>
            </div>

            <div style="margin-top:14px" class="mini">
              <span class="tag">Seed harian + username</span>
              <span class="tag">Hasil konsisten (akun sama, hari sama)</span>
              <span class="tag">Demo counters local</span>
            </div>

            <div style="margin-top:14px; color: rgba(255,255,255,.72); font-size: 12.5px; line-height:1.55">
              <b>Catatan jujur:</b>
              <div style="margin-top:6px">
                Kalau kamu mau ‚Äúanti-tebak‚Äù yang beneran, seed secret + claim harus dihitung di server, bukan di HTML.
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="footer">
        <div>
          <button class="linkBtn" id="openTnc">Syarat & Ketentuan</button>
          <button class="linkBtn" id="copyLink">Copy Link Event</button>
        </div>
        <div class="right">
          <span>¬© 2026 Angpao Event ‚Ä¢ UI Upgrade</span>
        </div>
      </div>
    </div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite">‚Äî</div>

  <!-- MODAL S&K -->
  <div id="modalBack" class="modalBack" role="dialog" aria-modal="true" aria-label="Syarat & Ketentuan">
    <div class="modal">
      <div class="modalHead">
        <b>üìå Syarat & Ketentuan ‚Äî Angpao Keberuntungan 2026</b>
        <button id="closeTnc" class="btn btnGhost">Tutup</button>
      </div>
      <div class="modalBody">
        <ul>
          <li>Event berlaku <b>1x buka per hari per akun</b> (reset pukul <b>00:00 WIB</b>).</li>
          <li>Hadiah berbentuk <b>Freebet</b> sesuai tier dan hasil angpao.</li>
          <li>Freebet memiliki masa aktif <b>24 jam sejak claim</b>.</li>
          <li>Penyalahgunaan (multi-akun/spam/eksploitasi) dapat menyebabkan <b>pembatalan promo</b>.</li>
          <li>Angka counter ‚Äúdibuka/dibagikan hari ini‚Äù pada file demo ini bersifat <b>simulasi</b>. Untuk angka global real, gunakan API server.</li>
        </ul>
      </div>
    </div>
  </div>

  <script>
    /* =========================
      BLOK 15 ‚Äî CONFIG
    ========================== */
    const CONFIG = {
      MODE: "DEMO",
      RESET_TZ: "Asia/Jakarta",
      PUBLIC_SALT: "ANGPAO-2026-DEMO-SALT",
      CLAIM_TTL_HOURS: 24,
      AMOUNT_STEP: 1000
    };

    /* =========================
      BLOK 16 ‚Äî TIERS
    ========================== */
    const TIERS = [
      { p: 0.60, min: 5000,  max: 8000,   label: "60% ‚Ä¢ Rp5.000 ‚Äì Rp8.000" },
      { p: 0.25, min: 9000,  max: 15000,  label: "25% ‚Ä¢ Rp9.000 ‚Äì Rp15.000" },
      { p: 0.10, min: 16000, max: 30000,  label: "10% ‚Ä¢ Rp16.000 ‚Äì Rp30.000" },
      { p: 0.04, min: 31000, max: 50000,  label: "4% ‚Ä¢ Rp31.000 ‚Äì Rp50.000" },
      { p: 0.01, min: 51000, max: 100000, label: "1% ‚Ä¢ Rp51.000 ‚Äì Rp100.000 (rare)" }
    ];

    /* =========================
      BLOK 17 ‚Äî UTIL
    ========================== */
    const $ = (s)=>document.querySelector(s);
    const fmtIDR = (n)=>new Intl.NumberFormat("id-ID").format(n);

    function getWibDateKey(){
      const parts = new Intl.DateTimeFormat("en-CA", {
        timeZone: CONFIG.RESET_TZ,
        year: "numeric", month: "2-digit", day: "2-digit"
      }).formatToParts(new Date());
      const m = Object.fromEntries(parts.map(p => [p.type, p.value]));
      return `${m.year}-${m.month}-${m.day}`;
    }
    function getNextResetMs(){
      const now = new Date();
      const nowWibStr = new Intl.DateTimeFormat("en-CA", {
        timeZone: CONFIG.RESET_TZ,
        year:"numeric", month:"2-digit", day:"2-digit"
      }).format(now);
      const target = new Date(`${nowWibStr}T00:00:00.000+07:00`);
      let next = target.getTime();
      if(now.getTime() >= next) next += 24*60*60*1000;
      return next - now.getTime();
    }

    function lsGet(k, f=null){
      try{
        const v=localStorage.getItem(k);
        return v?JSON.parse(v):f;
      }catch{
        return f;
      }
    }
    function lsSet(k, v){
      try{
        localStorage.setItem(k, JSON.stringify(v));
      }catch{
        // storage bisa diblok (mode private). UI tetap jalan.
      }
    }

    function toast(msg){
      const t = $("#toast");
      t.textContent = msg;
      t.classList.add("show");
      clearTimeout(toast._tm);
      toast._tm = setTimeout(()=>t.classList.remove("show"), 2100);
    }

    const prefersReducedMotion = matchMedia("(prefers-reduced-motion: reduce)").matches;

    function vib(ms=20){
      if(prefersReducedMotion) return;
      try{ if("vibrate" in navigator) navigator.vibrate(ms); }catch{}
    }

    /* =========================
      BLOK 18 ‚Äî RNG (DEMO)
    ========================== */
    function cyrb128(str){
      let h1=1779033703, h2=3144134277, h3=1013904242, h4=2773480762;
      for(let i=0, k; i<str.length; i++){
        k = str.charCodeAt(i);
        h1 = h2 ^ Math.imul(h1 ^ k, 597399067);
        h2 = h3 ^ Math.imul(h2 ^ k, 2869860233);
        h3 = h4 ^ Math.imul(h3 ^ k, 951274213);
        h4 = h1 ^ Math.imul(h4 ^ k, 2716044179);
      }
      h1 = Math.imul(h3 ^ (h1>>>18), 597399067);
      h2 = Math.imul(h4 ^ (h2>>>22), 2869860233);
      h3 = Math.imul(h1 ^ (h3>>>17), 951274213);
      h4 = Math.imul(h2 ^ (h4>>>19), 2716044179);
      return [(h1^h2^h3^h4)>>>0, (h2^h1)>>>0, (h3^h1)>>>0, (h4^h1)>>>0];
    }
    function sfc32(a,b,c,d){
      return function(){
        a >>>= 0; b >>>= 0; c >>>= 0; d >>>= 0;
        let t = (a + b) | 0;
        a = b ^ (b >>> 9);
        b = (c + (c << 3)) | 0;
        c = (c << 21 | c >>> 11);
        d = (d + 1) | 0;
        t = (t + d) | 0;
        c = (c + t) | 0;
        return (t >>> 0) / 4294967296;
      }
    }
    function pickTier(r){
      let acc=0;
      for(const t of TIERS){ acc += t.p; if(r < acc) return t; }
      return TIERS[TIERS.length-1];
    }
    function pickAmount(r, min, max, step){
      const count = Math.floor((max-min)/step) + 1;
      const idx = Math.min(count-1, Math.floor(r*count));
      return min + idx*step;
    }
    function shortHash(str){
      const s = cyrb128(str);
      return (s[0]>>>0).toString(16).padStart(8,"0").slice(0,8).toUpperCase();
    }

    /* =========================
      BLOK 19 ‚Äî STORAGE KEYS
    ========================== */
    function kUser(){ return "angpao2026:user"; }
    function kClaim(user){ return `angpao2026:claim:${getWibDateKey()}:${user}`; }
    function kShare(user){ return `angpao2026:share:${getWibDateKey()}:${user}`; }
    function kDemoCounters(){ return `angpao2026:counters:${getWibDateKey()}`; }

    /* =========================
      BLOK 20 ‚Äî DEMO COUNTERS
    ========================== */
    function initDemoCounters(){
      const seedBase = `${CONFIG.PUBLIC_SALT}|${getWibDateKey()}|COUNTERS`;
      const seed = cyrb128(seedBase);
      const rng = sfc32(seed[0], seed[1], seed[2], seed[3]);
      const baseOpened = 3000 + Math.floor(rng()*6000);
      const baseShared = 900 + Math.floor(rng()*3000);
      const cur = lsGet(kDemoCounters(), null);
      if(!cur) lsSet(kDemoCounters(), { baseOpened, baseShared, addOpened:0, addShared:0 });
    }
    function getCounters(){
      const c = lsGet(kDemoCounters(), { baseOpened:0, baseShared:0, addOpened:0, addShared:0 });
      return { opened: c.baseOpened + (c.addOpened||0), shared: c.baseShared + (c.addShared||0) };
    }
    function bumpOpened(){
      const c = lsGet(kDemoCounters(), null); if(!c) return;
      c.addOpened = (c.addOpened||0)+1; lsSet(kDemoCounters(), c);
    }
    function bumpShared(){
      const c = lsGet(kDemoCounters(), null); if(!c) return;
      c.addShared = (c.addShared||0)+1; lsSet(kDemoCounters(), c);
    }

    /* =========================
      BLOK 21 ‚Äî RESULT ENGINE (DEMO)
    ========================== */
    function computeResultFor(user){
      const dayKey = getWibDateKey();
      const seedStr = `${CONFIG.PUBLIC_SALT}|${dayKey}|${user}`;
      const seed = cyrb128(seedStr);
      const rng = sfc32(seed[0], seed[1], seed[2], seed[3]);

      const tier = pickTier(rng());
      const amount = pickAmount(rng(), tier.min, tier.max, CONFIG.AMOUNT_STEP);

      let note="Umum";
      if(tier.p <= 0.01) note = "Rare";
      else if(tier.p <= 0.04) note = "Jarang";
      else if(tier.p <= 0.10) note = "Menengah";
      else if(tier.p <= 0.25) note = "Sering";

      const commit = shortHash(`${CONFIG.PUBLIC_SALT}|${dayKey}`);
      return { dayKey, tierLabel: tier.label, amount, note, commit };
    }

    /* =========================
      BLOK 22 ‚Äî CONFETTI (MINI) (warna variatif)
    ========================== */
    const confetti = (() => {
      const cv = $("#confetti");
      const ctx = cv.getContext("2d");
      let W=0,H=0, parts=[], raf=null, alive=false;

      const palette = [
        "rgba(255,211,110,.92)",
        "rgba(255,47,63,.88)",
        "rgba(255,255,255,.90)",
        "rgba(247,178,47,.90)"
      ];

      function resize(){
        const r = cv.getBoundingClientRect();
        cv.width = Math.max(1, Math.floor(r.width * devicePixelRatio));
        cv.height= Math.max(1, Math.floor(r.height* devicePixelRatio));
        W=cv.width; H=cv.height;
      }
      window.addEventListener("resize", resize, { passive:true });

      function randPick(a){ return a[(Math.random()*a.length)|0]; }

      function spawn(n=90){
        parts = [];
        for(let i=0;i<n;i++){
          parts.push({
            x: Math.random()*W,
            y: -Math.random()*H*0.2,
            vx: (Math.random()-.5)*1.6*devicePixelRatio,
            vy: (Math.random()*2.4+1.3)*devicePixelRatio,
            r: (Math.random()*3.4+2.0)*devicePixelRatio,
            color: randPick(palette)
          });
        }
        alive = true;
      }
      function draw(){
        if(!alive) return;
        ctx.clearRect(0,0,W,H);
        for(const p of parts){
          p.x += p.vx; p.y += p.vy; p.vy *= 1.008;
          const alpha = Math.max(0, 1 - p.y/(H*1.05));
          ctx.globalAlpha = alpha*0.95;
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
          ctx.fillStyle = p.color;
          ctx.fill();
        }
        ctx.globalAlpha = 1;
        parts = parts.filter(p => p.y < H + 50*devicePixelRatio);
        if(parts.length) raf = requestAnimationFrame(draw);
        else {
          alive=false;
          $("#confetti").classList.remove("confettiOn");
        }
      }
      function boom(){
        if(prefersReducedMotion) return;
        resize();
        spawn(92);
        $("#confetti").classList.add("confettiOn");
        cancelAnimationFrame(raf);
        raf = requestAnimationFrame(draw);
        setTimeout(()=> $("#confetti").classList.remove("confettiOn"), 900);
      }
      return { boom };
    })();

    /* =========================
      BLOK 23 ‚Äî UI STATE
    ========================== */
    const el = {
      modeLabel: $("#modeLabel"),
      commitHash: $("#commitHash"),
      countdown: $("#countdown"),
      openedToday: $("#openedToday"),
      sharedToday: $("#sharedToday"),

      username: $("#username"),
      saveUser: $("#saveUser"),
      resetAll: $("#resetAll"),

      chances: $("#chances"),
      statusText: $("#statusText"),

      angpao: $("#angpao"),
      openBtn: $("#openBtn"),
      claimBtn: $("#claimBtn"),
      shareBtn: $("#shareBtn"),

      resultAmount: $("#resultAmount"),
      resultHint: $("#resultHint"),
      resultSub: $("#resultSub"),
      tierLabelMini: $("#tierLabelMini"),

      modalBack: $("#modalBack"),
      openTnc: $("#openTnc"),
      closeTnc: $("#closeTnc"),
      copyLink: $("#copyLink"),
    };

    let state = {
      user: "",
      dayKey: getWibDateKey(),
      opened: false,
      claimed: false,
      shared: false,
      result: null
    };

    function setEnabled(){
      const hasUser = !!state.user;
      el.angpao.classList.toggle("envDisabled", !hasUser || state.claimed);
      el.openBtn.disabled  = !hasUser || state.claimed;
      el.claimBtn.disabled = !hasUser || !state.opened || state.claimed;
      el.shareBtn.disabled = !hasUser || !state.claimed || state.shared;

      el.chances.textContent = state.user ? (state.claimed ? "0/1" : "1/1") : "‚Äî";
      el.statusText.textContent = !state.user ? "Butuh username"
        : state.claimed ? "Sudah claim hari ini"
        : state.opened ? "Hasil siap di-claim"
        : "Siap buka angpao";
    }

    function loadUser(){
      const u = lsGet(kUser(), "");
      if(u){ state.user = u; el.username.value = u; }
    }

    function updateCountdown(){
      const ms = getNextResetMs();
      const s = Math.max(0, Math.floor(ms/1000));
      const h = String(Math.floor(s/3600)).padStart(2,"0");
      const m = String(Math.floor((s%3600)/60)).padStart(2,"0");
      const sec = String(s%60).padStart(2,"0");
      el.countdown.textContent = `${h}:${m}:${sec}`;
    }

    function updateCountersUI(){
      const c = getCounters();
      el.openedToday.textContent = fmtIDR(c.opened);
      el.sharedToday.textContent = fmtIDR(c.shared);
    }

    function updateCommitHashUI(){
      const dayKey = getWibDateKey();
      el.commitHash.textContent = shortHash(`${CONFIG.PUBLIC_SALT}|${dayKey}`);
    }

    function hardResetEnvelopeUI(){
      el.angpao.classList.remove("isOpening","isOpen");
      el.angpao.classList.add("angpaoIdle");
      el.resultAmount.textContent = "Rp‚Äî";
      el.tierLabelMini.textContent = "Tier";
      el.resultHint.textContent = "Klik ‚ÄúBuka Angpao‚Äù untuk melihat hasil. Setelah itu kamu bisa claim freebet.";
      el.resultSub.textContent = "1x/hari ‚Ä¢ tidak ada kupon ‚Ä¢ freebet aktif 24 jam";
    }

    function refreshDay(){
      const dk = getWibDateKey();
      if(dk !== state.dayKey){
        state.dayKey = dk;
        state.opened = false;
        state.claimed = false;
        state.shared = false;
        state.result = null;

        hardResetEnvelopeUI();

        initDemoCounters();
        updateCountersUI();
        updateCommitHashUI();
        loadClaimFlags();
        setEnabled();
      }
    }

    function loadClaimFlags(){
      if(!state.user) return;
      const claim = lsGet(kClaim(state.user), null);
      state.claimed = !!claim;

      const share = lsGet(kShare(state.user), null);
      state.shared = !!share;

      if(state.claimed){
        state.result = claim;
        state.opened = true;
        el.angpao.classList.add("isOpen");
        el.angpao.classList.remove("angpaoIdle");

        el.resultAmount.textContent = "Rp" + fmtIDR(claim.amount);
        el.tierLabelMini.textContent = claim.tierLabel.split("‚Ä¢")[0].trim() || "Tier";
        el.resultHint.textContent = `Status: sudah claim ‚Ä¢ ${claim.tierLabel}`;
        el.resultSub.textContent = "Masa aktif: 24 jam sejak claim";
      }else{
        state.opened = false;
        state.result = null;
        el.angpao.classList.remove("isOpen","isOpening");
        el.angpao.classList.add("angpaoIdle");
      }
    }

    function openSequence(){
      // Opening keyframes ‚Üí set Open setelah animasi selesai (sinkron)
      el.angpao.classList.remove("isOpen");
      el.angpao.classList.add("isOpening");
      el.angpao.classList.remove("angpaoIdle");

      clearTimeout(openSequence._tm);
      openSequence._tm = setTimeout(() => {
        el.angpao.classList.remove("isOpening");
        el.angpao.classList.add("isOpen");
      }, 980);
    }

    /* Count-up number (biar terasa premium) */
    function animateAmount(to){
      if(prefersReducedMotion){
        el.resultAmount.textContent = "Rp" + fmtIDR(to);
        return;
      }
      const start = performance.now();
      const from = 0;
      const dur = 650;

      function easeOutCubic(t){ return 1 - Math.pow(1 - t, 3); }

      function step(now){
        const t = Math.min(1, (now - start) / dur);
        const v = Math.round(from + (to - from) * easeOutCubic(t));
        // tampilkan dengan format, tapi tetap terlihat smooth
        el.resultAmount.textContent = "Rp" + fmtIDR(v);
        if(t < 1) requestAnimationFrame(step);
        else el.resultAmount.textContent = "Rp" + fmtIDR(to);
      }
      requestAnimationFrame(step);
    }

    function openAngpao(){
      if(!state.user) return toast("Isi dulu username.");
      if(state.claimed) return toast("Kamu sudah claim hari ini.");
      if(state.opened) return toast("Hasil sudah terbuka. Silakan claim.");

      state.result = computeResultFor(state.user);
      state.opened = true;

      animateAmount(state.result.amount);
      el.tierLabelMini.textContent = state.result.tierLabel.split("‚Ä¢")[0].trim() || "Tier";
      el.resultHint.textContent = `${state.result.note} ‚Ä¢ ${state.result.tierLabel} ‚Ä¢ Claim untuk mengunci hadiah.`;
      el.resultSub.textContent = "Setelah claim, kamu bisa bagikan ke WhatsApp.";

      bumpOpened();
      updateCountersUI();

      openSequence();
      confetti.boom();
      vib(25);
      toast("Angpao terbuka! Claim untuk mengunci hadiah.");
      setEnabled();
    }

    function claim(){
      if(!state.user) return toast("Isi dulu username.");
      if(!state.opened || !state.result) return toast("Buka angpao dulu.");
      if(state.claimed) return toast("Sudah claim.");

      const payload = {
        dayKey: getWibDateKey(),
        user: state.user,
        amount: state.result.amount,
        tierLabel: state.result.tierLabel,
        claimedAt: Date.now(),
        expiresAt: Date.now() + CONFIG.CLAIM_TTL_HOURS*60*60*1000
      };
      lsSet(kClaim(state.user), payload);
      state.claimed = true;

      el.resultHint.textContent = `Status: sudah claim ‚Ä¢ ${payload.tierLabel}`;
      el.resultSub.textContent = "Masa aktif: 24 jam sejak claim";
      vib(18);
      toast("Freebet berhasil di-claim.");
      setEnabled();
    }

    function shareWA(){
      if(!state.user) return toast("Username belum ada.");
      if(!state.claimed) return toast("Claim dulu sebelum share.");
      if(state.shared) return toast("Kamu sudah share hari ini.");

      const claim = lsGet(kClaim(state.user), null);
      if(!claim) return toast("Data claim tidak ditemukan.");

      const url = location.href.split("#")[0];
      const text =
        `Aku baru dapet Angpao Keberuntungan 2026 üßß\n` +
        `Freebet: Rp${fmtIDR(claim.amount)}\n` +
        `Ikutan buka angpao hari ini: ${url}`;

      window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, "_blank", "noopener,noreferrer");

      lsSet(kShare(state.user), { sharedAt: Date.now() });
      state.shared = true;

      bumpShared();
      updateCountersUI();
      vib(14);
      toast("Link WhatsApp dibuka. Mantap!");
      setEnabled();
    }

    function saveUser(){
      const u = (el.username.value || "").trim();
      if(u.length < 3) return toast("Username minimal 3 karakter.");
      const safe = u.replace(/\s+/g,"");
      state.user = safe;
      el.username.value = safe;
      lsSet(kUser(), safe);

      loadClaimFlags();
      vib(10);
      toast("Username tersimpan.");
      setEnabled();
    }

    function resetDemo(){
      const keys = [];
      try{
        for(let i=0;i<localStorage.length;i++){
          const k = localStorage.key(i);
          if(k && k.startsWith("angpao2026:")) keys.push(k);
        }
        keys.forEach(k => localStorage.removeItem(k));
      }catch{
        // ignore
      }

      state.user = "";
      el.username.value = "";
      state.opened=false; state.claimed=false; state.shared=false; state.result=null;

      hardResetEnvelopeUI();

      initDemoCounters();
      updateCountersUI();
      updateCommitHashUI();
      vib(12);
      toast("Reset demo selesai.");
      setEnabled();
    }

    /* =========================
      BLOK 24 ‚Äî POINTER TILT (hanya desktop hover/fine pointer)
    ========================== */
    function attachTilt(elm){
      let raf = 0;
      function onMove(e){
        if(elm.classList.contains("envDisabled")) return;
        const r = elm.getBoundingClientRect();
        const x = (e.clientX - r.left) / r.width;
        const y = (e.clientY - r.top) / r.height;

        const ry = (x - 0.5) * 14;      // left-right
        const rx = (0.5 - y) * 10;      // up-down

        const shineX = Math.round(x*100) + "%";
        const shineY = Math.round(y*100) + "%";

        cancelAnimationFrame(raf);
        raf = requestAnimationFrame(() => {
          elm.style.setProperty("--ry", ry.toFixed(2) + "deg");
          elm.style.setProperty("--rx", rx.toFixed(2) + "deg");
          elm.style.setProperty("--shineX", shineX);
          elm.style.setProperty("--shineY", shineY);
        });
      }
      function onLeave(){
        elm.style.setProperty("--ry","0deg");
        elm.style.setProperty("--rx","0deg");
        elm.style.setProperty("--shineX","20%");
        elm.style.setProperty("--shineY","0%");
      }
      elm.addEventListener("pointermove", onMove, { passive:true });
      elm.addEventListener("pointerleave", onLeave, { passive:true });
    }

    /* =========================
      BLOK 25 ‚Äî EVENTS
    ========================== */
    el.openBtn.addEventListener("click", openAngpao);
    el.claimBtn.addEventListener("click", claim);
    el.shareBtn.addEventListener("click", shareWA);
    el.saveUser.addEventListener("click", saveUser);
    el.resetAll.addEventListener("click", resetDemo);

    el.angpao.addEventListener("click", () => { if(!el.openBtn.disabled) openAngpao(); });
    el.angpao.addEventListener("keydown", (e) => {
      if(e.key === "Enter" || e.key === " "){
        e.preventDefault();
        if(!el.openBtn.disabled) openAngpao();
      }
    });

    // Modal
    $("#openTnc").addEventListener("click", () => $("#modalBack").classList.add("show"));
    $("#closeTnc").addEventListener("click", () => $("#modalBack").classList.remove("show"));
    $("#modalBack").addEventListener("click", (e) => { if(e.target.id==="modalBack") $("#modalBack").classList.remove("show"); });

    // Copy link
    $("#copyLink").addEventListener("click", async () => {
      const link = location.href.split("#")[0];
      try{
        await navigator.clipboard.writeText(link);
        vib(10);
        toast("Link event berhasil disalin.");
      }catch{
        toast("Gagal copy. Silakan copy manual dari address bar.");
      }
    });

    // Enter = simpan username (biar enak di HP)
    el.username.addEventListener("keydown", (e)=>{
      if(e.key === "Enter"){ e.preventDefault(); saveUser(); }
    });

    /* =========================
      BLOK 26 ‚Äî INIT + TICK (lebih hemat CPU)
    ========================== */
    let clockTimer = null;

    function init(){
      el.modeLabel.textContent = CONFIG.MODE;

      initDemoCounters();
      updateCountersUI();
      updateCommitHashUI();

      loadUser();
      loadClaimFlags();
      setEnabled();
      updateCountdown();

      // Tilt cuma di desktop hover/fine pointer
      const canHover = matchMedia("(hover:hover) and (pointer:fine)").matches;
      if(canHover && !prefersReducedMotion) attachTilt(el.angpao);

      // Countdown cukup 1x/detik (lebih stabil daripada rAF)
      clearInterval(clockTimer);
      clockTimer = setInterval(() => {
        refreshDay();
        updateCountdown();
      }, 1000);

      // Saat tab balik aktif, refresh juga
      document.addEventListener("visibilitychange", () => {
        if(!document.hidden){
          refreshDay();
          updateCountdown();
          updateCommitHashUI();
          updateCountersUI();
        }
      }, { passive:true });
    }
    init();
  </script>
</body>
</html>
