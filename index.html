<!doctype html>
<html lang="id">
<head>
  <!-- =========================
    BLOK 1 ‚Äî META / SEO / PWA-LITE
  ========================== -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="color-scheme" content="dark light" />
  <meta name="theme-color" content="#0b0613" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>Angpao Keberuntungan 2026</title>
  <meta name="description" content="Event harian: buka 1 angpao, claim freebet, bagikan ke WA. Reset 00:00 WIB." />

  <!-- =========================
    BLOK 2 ‚Äî FONTS
  ========================== -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">

  <style>
    /* =========================
      BLOK 3 ‚Äî THEME TOKENS (ANGPAO 2026)
    ========================== */
    :root{
      --bg0:#07040e;
      --bg1:#0b0613;
      --glass: rgba(255,255,255,.08);
      --stroke: rgba(255,255,255,.14);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.66);

      --red:#ff2f3f;
      --red2:#b1121c;
      --gold:#ffd36e;
      --gold2:#f7b22f;

      --ok:#38ef7d;
      --warn:#ffcc66;

      --shadow: 0 18px 60px rgba(0,0,0,.55);
      --shadow2: 0 10px 30px rgba(0,0,0,.45);
      --radius: 22px;

      --easeOut: cubic-bezier(.2,.9,.2,1);
      --easeSoft: cubic-bezier(.22,.8,.22,1);
      --easePop: cubic-bezier(.18,1.08,.24,1);
    }

    /* =========================
      BLOK 4 ‚Äî RESET / BASE
    ========================== */
    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 20% 10%, rgba(255,47,63,.16), transparent 60%),
        radial-gradient(900px 520px at 85% 25%, rgba(255,211,110,.14), transparent 55%),
        radial-gradient(900px 720px at 55% 95%, rgba(160,120,255,.10), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
    }

    a{ color:inherit; text-decoration:none; }
    button, input{
      font: inherit;
      color: inherit;
    }

    .wrap{
      min-height:100%;
      display:grid;
      place-items:center;
      padding: 28px 18px 42px;
    }

    /* =========================
      BLOK 5 ‚Äî BACKDROP NOISE + SPARKS
    ========================== */
    .noise{
      pointer-events:none;
      position:fixed; inset:0;
      opacity:.12;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='260' height='260'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.7' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='260' height='260' filter='url(%23n)' opacity='.35'/%3E%3C/svg%3E");
      mix-blend-mode: overlay;
    }
    .sparks{
      pointer-events:none;
      position:fixed; inset:-20%;
      background:
        radial-gradient(circle at 20% 30%, rgba(255,211,110,.10), transparent 35%),
        radial-gradient(circle at 80% 40%, rgba(255,47,63,.08), transparent 34%),
        radial-gradient(circle at 50% 75%, rgba(255,255,255,.06), transparent 36%);
      animation: drift 14s var(--easeSoft) infinite alternate;
      filter: blur(18px) saturate(1.25);
      opacity:.9;
    }
    @keyframes drift{
      0%{ transform: translate3d(-1.2%, -1.1%, 0) scale(1.02); }
      100%{ transform: translate3d(1.4%, 1.2%, 0) scale(1.06); }
    }

    /* =========================
      BLOK 6 ‚Äî CARD LAYOUT
    ========================== */
    .card{
      width:min(980px, 100%);
      border:1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      overflow:hidden;
      position:relative;
      backdrop-filter: blur(18px) saturate(1.25);
    }

    .card::before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(600px 260px at 18% 10%, rgba(255,47,63,.22), transparent 55%),
        radial-gradient(540px 280px at 85% 15%, rgba(255,211,110,.18), transparent 55%);
      opacity:.7;
      filter: blur(1px);
      pointer-events:none;
    }

    .head{
      position:relative;
      padding: 22px 22px 0;
      display:flex;
      gap:16px;
      align-items:flex-start;
      justify-content:space-between;
      flex-wrap:wrap;
    }

    .titleWrap{ min-width: 240px; }
    h1{
      margin:0;
      font-size: clamp(22px, 2.6vw, 32px);
      letter-spacing: .2px;
    }
    .sub{
      margin:8px 0 0;
      color:var(--muted);
      line-height:1.45;
      font-size: 13.5px;
      max-width: 62ch;
    }

    .pillRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:flex-end;
    }
    .pill{
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.18);
      padding: 9px 12px;
      border-radius: 999px;
      display:flex;
      gap:10px;
      align-items:center;
      box-shadow: var(--shadow2);
      backdrop-filter: blur(10px) saturate(1.2);
    }
    .pill b{
      font-size: 12.5px;
      letter-spacing:.2px;
    }
    .pill span{
      font-size: 12px;
      color: var(--muted);
    }

    .grid{
      position:relative;
      padding: 18px 22px 22px;
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap: 16px;
      align-items:stretch;
    }

    @media (max-width: 860px){
      .grid{ grid-template-columns: 1fr; }
      .pillRow{ justify-content:flex-start; }
    }

    .pane{
      border:1px solid var(--stroke);
      background: rgba(8,6,14,.35);
      border-radius: 18px;
      box-shadow: var(--shadow2);
      position:relative;
      overflow:hidden;
    }

    .paneInner{
      padding: 16px;
      position:relative;
    }

    /* =========================
      BLOK 7 ‚Äî STATUS / INPUT USERNAME
    ========================== */
    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .label{
      font-size: 12px;
      color: var(--muted);
    }
    .input{
      flex:1;
      min-width: 220px;
      border-radius: 14px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      padding: 11px 12px;
      outline:none;
      transition: transform .18s var(--easeOut), border-color .18s var(--easeOut);
    }
    .input:focus{
      border-color: rgba(255,211,110,.45);
      transform: translateY(-1px);
    }

    .btn{
      border:1px solid rgba(255,255,255,.18);
      background: linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.08));
      padding: 11px 14px;
      border-radius: 14px;
      cursor:pointer;
      transition: transform .18s var(--easeOut), filter .18s var(--easeOut), box-shadow .18s var(--easeOut);
      box-shadow: 0 10px 22px rgba(0,0,0,.35);
      user-select:none;
    }
    .btn:hover{ transform: translateY(-1px); filter: brightness(1.06); }
    .btn:active{ transform: translateY(0px) scale(.99); }

    .btnPrimary{
      border-color: rgba(255,211,110,.35);
      background: linear-gradient(180deg, rgba(255,211,110,.22), rgba(255,47,63,.14));
    }
    .btnDanger{
      border-color: rgba(255,47,63,.35);
      background: linear-gradient(180deg, rgba(255,47,63,.22), rgba(0,0,0,.12));
    }
    .btnGhost{
      background: transparent;
      box-shadow:none;
    }
    .btn[disabled]{
      opacity:.55;
      cursor:not-allowed;
      filter: grayscale(.1);
      transform:none !important;
    }

    .mini{
      font-size: 12px;
      color: var(--muted);
      line-height:1.5;
      margin-top: 10px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .tag{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      padding: 6px 10px;
      border-radius: 999px;
    }

    /* =========================
      BLOK 8 ‚Äî ENVELOPE (ANGPAO) UI
    ========================== */
    .stage{
      display:grid;
      place-items:center;
      min-height: 360px;
      padding: 12px 14px 18px;
      position:relative;
    }

    .envelopeWrap{
      width: min(420px, 100%);
      display:grid;
      gap: 14px;
      justify-items:center;
    }

    .envelope{
      width: 310px;
      height: 210px;
      position:relative;
      transform-style:preserve-3d;
      filter: drop-shadow(0 18px 40px rgba(0,0,0,.55));
      user-select:none;
      cursor:pointer;
    }

    .envBody{
      position:absolute; inset:0;
      border-radius: 18px;
      background: linear-gradient(180deg, rgba(255,47,63,.92), rgba(177,18,28,.92));
      border: 1px solid rgba(255,255,255,.18);
      overflow:hidden;
    }

    .envBody:before{
      content:"";
      position:absolute; inset:-40%;
      background:
        radial-gradient(circle at 30% 20%, rgba(255,211,110,.32), transparent 55%),
        radial-gradient(circle at 80% 70%, rgba(255,255,255,.10), transparent 55%);
      filter: blur(8px);
      opacity:.9;
      transform: rotate(10deg);
    }

    .pattern{
      position:absolute; inset:0;
      background:
        radial-gradient(circle at 18% 28%, rgba(255,211,110,.25), transparent 22%),
        radial-gradient(circle at 78% 40%, rgba(255,255,255,.10), transparent 20%),
        radial-gradient(circle at 40% 75%, rgba(255,211,110,.18), transparent 24%);
      opacity:.55;
      mix-blend-mode: screen;
      pointer-events:none;
    }

    .seal{
      position:absolute;
      left:50%; top:52%;
      transform: translate(-50%,-50%);
      width: 64px; height: 64px;
      border-radius: 999px;
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,.20), transparent 45%),
        radial-gradient(circle at 60% 70%, rgba(0,0,0,.22), transparent 55%),
        linear-gradient(180deg, rgba(255,211,110,.95), rgba(247,178,47,.95));
      border: 1px solid rgba(255,255,255,.20);
      box-shadow: 0 12px 22px rgba(0,0,0,.40);
      display:grid;
      place-items:center;
      font-weight:900;
      letter-spacing:.4px;
      color: rgba(20,10,10,.85);
    }

    .seal small{
      display:block;
      font-weight:800;
      font-size: 11px;
      opacity:.92;
      transform: translateY(1px);
    }

    .flap{
      position:absolute;
      left:0; right:0;
      top:-2px;
      height: 56%;
      transform-origin: 50% 0%;
      transform: rotateX(0deg);
      transition: transform .9s var(--easePop);
      z-index: 4;
    }
    .flap:before{
      content:"";
      position:absolute; inset:0;
      background: linear-gradient(180deg, rgba(255,80,90,.96), rgba(170,14,22,.95));
      clip-path: polygon(0 0, 100% 0, 50% 100%);
      border-top-left-radius: 18px;
      border-top-right-radius: 18px;
      border: 1px solid rgba(255,255,255,.16);
      border-bottom: none;
    }

    .letter{
      position:absolute;
      left: 10px;
      right: 10px;
      bottom: 10px;
      height: 74%;
      border-radius: 16px;
      background: linear-gradient(180deg, rgba(255,255,255,.96), rgba(255,255,255,.90));
      border: 1px solid rgba(0,0,0,.08);
      transform: translateY(26px);
      transition: transform .9s var(--easePop), opacity .35s var(--easeOut);
      z-index: 2;
      overflow:hidden;
    }
    .letter::before{
      content:"";
      position:absolute; inset:-30%;
      background:
        radial-gradient(circle at 18% 22%, rgba(255,211,110,.25), transparent 40%),
        radial-gradient(circle at 80% 70%, rgba(255,47,63,.16), transparent 45%);
      transform: rotate(10deg);
    }

    .letterInner{
      position:relative;
      height:100%;
      display:grid;
      place-items:center;
      padding: 16px;
      color: #140a0a;
      text-align:center;
    }
    .letterInner .top{
      display:flex;
      gap: 10px;
      align-items:center;
      justify-content:center;
      color: rgba(20,10,10,.70);
      font-weight:800;
      letter-spacing:.2px;
      font-size: 12px;
      margin-bottom: 10px;
    }
    .amount{
      font-size: 34px;
      font-weight: 900;
      letter-spacing: .3px;
      margin: 6px 0 10px;
    }
    .hint{
      font-size: 12.5px;
      color: rgba(20,10,10,.70);
      line-height:1.45;
      max-width: 34ch;
      margin: 0 auto;
    }

    .envOpen .flap{ transform: rotateX(165deg); }
    .envOpen .letter{ transform: translateY(-26px); }

    .envDisabled{
      cursor:not-allowed;
      opacity:.75;
      filter: grayscale(.12) saturate(.9);
    }

    .ctaRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:center;
      margin-top: 2px;
    }

    /* =========================
      BLOK 9 ‚Äî TIER PANEL
    ========================== */
    .tierTitle{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom: 12px;
    }
    .tierTitle h2{
      margin:0;
      font-size: 14px;
      letter-spacing:.2px;
    }
    .tierTitle .tz{
      font-size: 12px;
      color: var(--muted);
    }

    .tierList{
      display:grid;
      gap: 10px;
    }
    .tier{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      border-radius: 16px;
      padding: 10px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
    }
    .tier b{
      font-size: 13px;
      letter-spacing:.2px;
    }
    .tier span{
      font-size: 12px;
      color: var(--muted);
    }
    .bar{
      height: 8px;
      border-radius: 999px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.12);
      overflow:hidden;
      flex: 1;
      max-width: 260px;
    }
    .bar i{
      display:block;
      height:100%;
      width: var(--w, 30%);
      background: linear-gradient(90deg, rgba(255,211,110,.65), rgba(255,47,63,.55));
      border-radius: 999px;
    }

    /* =========================
      BLOK 10 ‚Äî TOAST / MODAL
    ========================== */
    .toast{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      background: rgba(0,0,0,.62);
      border: 1px solid rgba(255,255,255,.14);
      backdrop-filter: blur(16px) saturate(1.2);
      padding: 10px 12px;
      border-radius: 999px;
      box-shadow: var(--shadow2);
      display:flex;
      gap:10px;
      align-items:center;
      opacity:0;
      pointer-events:none;
      transition: opacity .18s var(--easeOut), transform .18s var(--easeOut);
      font-size: 12.5px;
      color: rgba(255,255,255,.90);
      z-index: 50;
    }
    .toast.show{
      opacity:1;
      transform: translateX(-50%) translateY(-2px);
    }

    .modalBack{
      position:fixed; inset:0;
      background: rgba(0,0,0,.55);
      display:none;
      place-items:center;
      padding: 18px;
      z-index: 60;
    }
    .modalBack.show{ display:grid; }

    .modal{
      width: min(720px, 100%);
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(15,10,25,.85);
      backdrop-filter: blur(18px) saturate(1.2);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .modalHead{
      padding: 14px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      border-bottom: 1px solid rgba(255,255,255,.12);
    }
    .modalHead b{ font-size: 13.5px; letter-spacing:.2px; }
    .modalBody{
      padding: 14px 16px 16px;
      color: rgba(255,255,255,.86);
      font-size: 13px;
      line-height:1.55;
    }
    .modalBody ul{ margin: 10px 0 0 18px; }
    .modalBody li{ margin: 6px 0; }

    /* =========================
      BLOK 11 ‚Äî CONFETTI CANVAS (MINI)
    ========================== */
    canvas#confetti{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      pointer-events:none;
      opacity:0;
      transition: opacity .25s var(--easeOut);
    }
    .confettiOn{ opacity: 1; }

    /* Reduce motion */
    @media (prefers-reduced-motion: reduce){
      .sparks{ animation:none; }
      .btn, .flap, .letter, .toast{ transition:none !important; }
    }

    /* =========================
      BLOK 12 ‚Äî FOOTER NOTES
    ========================== */
    .footer{
      margin-top: 14px;
      color: rgba(255,255,255,.55);
      font-size: 12px;
      line-height:1.5;
      padding: 0 4px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:space-between;
      align-items:center;
    }
    .footer .right{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .linkBtn{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      padding: 7px 10px;
      border-radius: 999px;
      cursor:pointer;
    }
  </style>
</head>
<body>
  <div class="sparks"></div>
  <div class="noise"></div>

  <div class="wrap">
    <div class="card" role="application" aria-label="Angpao Keberuntungan 2026">
      <canvas id="confetti"></canvas>

      <div class="head">
        <div class="titleWrap">
          <h1>üßß Angpao Keberuntungan 2026</h1>
          <p class="sub">
            Buka <b>1 angpao per hari</b> untuk dapat Freebet sesuai tier. Setelah claim, kamu bisa bagikan ke WhatsApp untuk bikin event rame.
            <span style="display:block;margin-top:6px;color:rgba(255,255,255,.55);font-size:12px">
              Reset: <b>00:00 WIB</b> ‚Ä¢ Mode: <span id="modeLabel">DEMO</span> ‚Ä¢ Seed Commit: <span id="commitHash">‚Äî</span>
            </span>
          </p>
        </div>

        <div class="pillRow">
          <div class="pill" title="Waktu tersisa sebelum reset">
            <b>Reset dalam</b>
            <span id="countdown">‚Äî</span>
          </div>
          <div class="pill" title="Counter ini demo (local). Untuk angka global, pakai API server.">
            <b>Dibuka hari ini</b>
            <span id="openedToday">‚Äî</span>
          </div>
          <div class="pill" title="Counter ini demo (local). Untuk angka global, pakai API server.">
            <b>Dibagikan hari ini</b>
            <span id="sharedToday">‚Äî</span>
          </div>
        </div>
      </div>

      <div class="grid">
        <!-- PANE KIRI: INTERAKSI ANGPAO -->
        <div class="pane">
          <div class="paneInner">
            <div class="row" style="justify-content:space-between; align-items:flex-end;">
              <div style="flex:1; min-width:260px">
                <div class="label">Username (wajib, untuk seed harian)</div>
                <div class="row" style="margin-top:8px">
                  <input id="username" class="input" placeholder="contoh: garr123" autocomplete="off" spellcheck="false" />
                  <button id="saveUser" class="btn btnPrimary">Simpan</button>
                  <button id="resetAll" class="btn btnGhost" title="Reset demo local (hapus penyimpanan)">Reset</button>
                </div>
                <div class="mini">
                  <span class="tag">Sisa kesempatan hari ini: <b id="chances">‚Äî</b></span>
                  <span class="tag">Status: <b id="statusText">Butuh username</b></span>
                </div>
              </div>
            </div>

            <div class="stage">
              <div class="envelopeWrap">
                <div id="envelope" class="envelope envDisabled" aria-label="Klik untuk membuka angpao" role="button" tabindex="0">
                  <div class="envBody">
                    <div class="pattern"></div>
                  </div>

                  <div class="flap"></div>
                  <div class="seal"><div>2026<small>ANGPAO</small></div></div>

                  <div class="letter" aria-hidden="true">
                    <div class="letterInner">
                      <div>
                        <div class="top">üéâ HASIL ANGPAO HARI INI</div>
                        <div class="amount" id="resultAmount">Rp‚Äî</div>
                        <div class="hint" id="resultHint">
                          Klik ‚ÄúBuka Angpao‚Äù untuk melihat hasil. Setelah itu kamu bisa claim freebet.
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="ctaRow">
                  <button id="openBtn" class="btn btnDanger" disabled>Buka Angpao</button>
                  <button id="claimBtn" class="btn btnPrimary" disabled>Claim Freebet</button>
                  <button id="shareBtn" class="btn" disabled>Bagikan ke WhatsApp</button>
                </div>

                <div class="mini" style="justify-content:center; text-align:center">
                  <span class="tag">Hanya 1x/hari ‚Ä¢ Freebet aktif 24 jam</span>
                  <span class="tag">Anti-spam: claim terkunci per akun</span>
                </div>
              </div>
            </div>

          </div>
        </div>

        <!-- PANE KANAN: INFO TIER + S&K -->
        <div class="pane">
          <div class="paneInner">
            <div class="tierTitle">
              <h2>Tier Freebet (Distribusi Hadiah)</h2>
              <div class="tz">Zona reset: WIB (Asia/Jakarta)</div>
            </div>

            <div class="tierList" aria-label="Daftar tier freebet">
              <div class="tier">
                <div>
                  <b>60% ‚Ä¢ Rp5.000 ‚Äì Rp8.000</b><br><span>Paling sering keluar</span>
                </div>
                <div class="bar" aria-hidden="true"><i style="--w:60%"></i></div>
              </div>

              <div class="tier">
                <div>
                  <b>25% ‚Ä¢ Rp9.000 ‚Äì Rp15.000</b><br><span>Sering</span>
                </div>
                <div class="bar" aria-hidden="true"><i style="--w:25%"></i></div>
              </div>

              <div class="tier">
                <div>
                  <b>10% ‚Ä¢ Rp16.000 ‚Äì Rp30.000</b><br><span>Menengah</span>
                </div>
                <div class="bar" aria-hidden="true"><i style="--w:10%"></i></div>
              </div>

              <div class="tier">
                <div>
                  <b>4% ‚Ä¢ Rp31.000 ‚Äì Rp50.000</b><br><span>Jarang</span>
                </div>
                <div class="bar" aria-hidden="true"><i style="--w:4%"></i></div>
              </div>

              <div class="tier">
                <div>
                  <b>1% ‚Ä¢ Rp51.000 ‚Äì Rp100.000</b><br><span>Rare</span>
                </div>
                <div class="bar" aria-hidden="true"><i style="--w:1%"></i></div>
              </div>
            </div>

            <div style="margin-top:14px" class="mini">
              <span class="tag">Seed harian + username</span>
              <span class="tag">Hasil konsisten untuk akun yang sama di hari itu</span>
              <span class="tag">Tidak ada kupon ‚Ä¢ Fokus Freebet</span>
            </div>

            <div style="margin-top:14px; color: rgba(255,255,255,.72); font-size: 12.5px; line-height:1.55">
              <b>Catatan implementasi:</b>
              <div style="margin-top:6px">
                Di mode demo ini, seed menggunakan salt publik + tanggal WIB + username. Untuk produksi:
                pindahkan RNG dan ‚Äúsecret seed‚Äù ke server agar tidak bisa ditebak/dimanipulasi.
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="footer">
        <div>
          <button class="linkBtn" id="openTnc">Syarat & Ketentuan</button>
          <button class="linkBtn" id="copyLink">Copy Link Event</button>
        </div>
        <div class="right">
          <span>¬© 2026 Angpao Event ‚Ä¢ Demo UI untuk Vercel</span>
        </div>
      </div>
    </div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite">‚Äî</div>

  <!-- MODAL S&K -->
  <div id="modalBack" class="modalBack" role="dialog" aria-modal="true" aria-label="Syarat & Ketentuan">
    <div class="modal">
      <div class="modalHead">
        <b>üìå Syarat & Ketentuan ‚Äî Angpao Keberuntungan 2026</b>
        <button id="closeTnc" class="btn btnGhost">Tutup</button>
      </div>
      <div class="modalBody">
        <ul>
          <li>Event berlaku <b>1x buka per hari per akun</b> (reset pukul <b>00:00 WIB</b>).</li>
          <li>Hadiah berbentuk <b>Freebet</b> sesuai tier dan hasil angpao.</li>
          <li>Freebet memiliki masa aktif <b>24 jam sejak claim</b>.</li>
          <li>Penyalahgunaan (multi-akun/spam/eksploitasi) dapat menyebabkan <b>pembatalan promo</b>.</li>
          <li>Angka counter ‚Äúdibuka/dibagikan hari ini‚Äù pada file demo ini bersifat <b>simulasi</b>.
            Untuk angka global real, gunakan API server.</li>
          <li>Pastikan event dan promo mematuhi aturan yang berlaku di wilayah operasionalmu.</li>
        </ul>
      </div>
    </div>
  </div>

  <script>
    /* =========================
      BLOK 13 ‚Äî CONFIG (DEMO/PROD)
    ========================== */
    const CONFIG = {
      MODE: "DEMO", // "DEMO" atau "PROD"
      RESET_TZ: "Asia/Jakarta", // WIB reset
      PUBLIC_SALT: "ANGPAO-2026-DEMO-SALT", // DEMO ONLY (jangan dipakai untuk secret)
      CLAIM_TTL_HOURS: 24,
      AMOUNT_STEP: 1000,

      // Untuk PROD: ganti dengan endpoint kamu (server menghitung seed secret + counters global)
      API: {
        // getCounters: "/api/angpao/counters?date=YYYY-MM-DD",
        // claim: "/api/angpao/claim",
        // share: "/api/angpao/share"
      }
    };

    /* =========================
      BLOK 14 ‚Äî TIERS (Sesuai permintaan)
    ========================== */
    const TIERS = [
      { p: 0.60, min: 5000,  max: 8000,   label: "60% ‚Ä¢ Rp5.000 ‚Äì Rp8.000" },
      { p: 0.25, min: 9000,  max: 15000,  label: "25% ‚Ä¢ Rp9.000 ‚Äì Rp15.000" },
      { p: 0.10, min: 16000, max: 30000,  label: "10% ‚Ä¢ Rp16.000 ‚Äì Rp30.000" },
      { p: 0.04, min: 31000, max: 50000,  label: "4% ‚Ä¢ Rp31.000 ‚Äì Rp50.000" },
      { p: 0.01, min: 51000, max: 100000, label: "1% ‚Ä¢ Rp51.000 ‚Äì Rp100.000 (rare)" }
    ];

    /* =========================
      BLOK 15 ‚Äî UTIL: DATE WIB, FORMAT, STORAGE
    ========================== */
    const $ = (sel) => document.querySelector(sel);
    const fmtIDR = (n) => new Intl.NumberFormat("id-ID").format(n);

    function getWibDateKey(){
      // YYYY-MM-DD using Asia/Jakarta regardless of user's local tz
      const parts = new Intl.DateTimeFormat("en-CA", {
        timeZone: CONFIG.RESET_TZ,
        year: "numeric", month: "2-digit", day: "2-digit"
      }).formatToParts(new Date());
      const m = Object.fromEntries(parts.map(p => [p.type, p.value]));
      return `${m.year}-${m.month}-${m.day}`;
    }

    function getNextResetMs(){
      // Next 00:00 WIB in ms (relative to now)
      const now = new Date();
      // Build "today at 00:00 WIB" then +1 day if already passed
      const nowWibStr = new Intl.DateTimeFormat("en-CA", {
        timeZone: CONFIG.RESET_TZ,
        year:"numeric", month:"2-digit", day:"2-digit"
      }).format(now); // YYYY-MM-DD
      const target = new Date(`${nowWibStr}T00:00:00.000+07:00`); // WIB offset
      let next = target.getTime();
      if(now.getTime() >= next) next += 24*60*60*1000;
      return next - now.getTime();
    }

    function lsGet(key, fallback=null){
      try{
        const v = localStorage.getItem(key);
        return v ? JSON.parse(v) : fallback;
      }catch{ return fallback; }
    }
    function lsSet(key, val){
      localStorage.setItem(key, JSON.stringify(val));
    }
    function lsDel(key){ localStorage.removeItem(key); }

    function toast(msg){
      const t = $("#toast");
      t.textContent = msg;
      t.classList.add("show");
      clearTimeout(toast._tm);
      toast._tm = setTimeout(()=>t.classList.remove("show"), 2100);
    }

    /* =========================
      BLOK 16 ‚Äî UTIL: SEEDED RNG (DEMO)
      - cyrb128 + sfc32: kecil, cepat, deterministic
    ========================== */
    function cyrb128(str){
      let h1=1779033703, h2=3144134277, h3=1013904242, h4=2773480762;
      for(let i=0, k; i<str.length; i++){
        k = str.charCodeAt(i);
        h1 = h2 ^ Math.imul(h1 ^ k, 597399067);
        h2 = h3 ^ Math.imul(h2 ^ k, 2869860233);
        h3 = h4 ^ Math.imul(h3 ^ k, 951274213);
        h4 = h1 ^ Math.imul(h4 ^ k, 2716044179);
      }
      h1 = Math.imul(h3 ^ (h1>>>18), 597399067);
      h2 = Math.imul(h4 ^ (h2>>>22), 2869860233);
      h3 = Math.imul(h1 ^ (h3>>>17), 951274213);
      h4 = Math.imul(h2 ^ (h4>>>19), 2716044179);
      return [(h1^h2^h3^h4)>>>0, (h2^h1)>>>0, (h3^h1)>>>0, (h4^h1)>>>0];
    }
    function sfc32(a,b,c,d){
      return function(){
        a >>>= 0; b >>>= 0; c >>>= 0; d >>>= 0;
        let t = (a + b) | 0;
        a = b ^ (b >>> 9);
        b = (c + (c << 3)) | 0;
        c = (c << 21 | c >>> 11);
        d = (d + 1) | 0;
        t = (t + d) | 0;
        c = (c + t) | 0;
        return (t >>> 0) / 4294967296;
      }
    }

    function pickTier(r){
      let acc = 0;
      for(const t of TIERS){
        acc += t.p;
        if(r < acc) return t;
      }
      return TIERS[TIERS.length-1];
    }

    function pickAmount(r, min, max, step){
      const count = Math.floor((max - min) / step) + 1;
      const idx = Math.min(count - 1, Math.floor(r * count));
      return min + idx * step;
    }

    /* =========================
      BLOK 17 ‚Äî STATE KEYS
    ========================== */
    function kUser(){ return "angpao2026:user"; }
    function kDay(){ return `angpao2026:day:${getWibDateKey()}`; }
    function kClaim(user){ return `angpao2026:claim:${getWibDateKey()}:${user}`; }
    function kShare(user){ return `angpao2026:share:${getWibDateKey()}:${user}`; }
    function kDemoCounters(){ return `angpao2026:counters:${getWibDateKey()}`; }

    /* =========================
      BLOK 18 ‚Äî DEMO COUNTERS (SIMULASI)
    ========================== */
    function initDemoCounters(){
      const seedBase = `${CONFIG.PUBLIC_SALT}|${getWibDateKey()}|COUNTERS`;
      const seed = cyrb128(seedBase);
      const rng = sfc32(seed[0], seed[1], seed[2], seed[3]);
      // base terlihat "ramai" tapi tetap konsisten per hari
      const baseOpened = 3000 + Math.floor(rng()*6000);  // 3k‚Äì9k
      const baseShared = 900 + Math.floor(rng()*3000);   // 900‚Äì3.9k
      const cur = lsGet(kDemoCounters(), null);
      if(!cur){
        lsSet(kDemoCounters(), { baseOpened, baseShared, addOpened:0, addShared:0 });
      }
    }

    function getCounters(){
      // DEMO local counters (untuk PROD: fetch API)
      const c = lsGet(kDemoCounters(), { baseOpened:0, baseShared:0, addOpened:0, addShared:0 });
      return {
        opened: c.baseOpened + (c.addOpened||0),
        shared: c.baseShared + (c.addShared||0)
      };
    }

    function bumpOpened(){
      const c = lsGet(kDemoCounters(), null);
      if(!c) return;
      c.addOpened = (c.addOpened||0) + 1;
      lsSet(kDemoCounters(), c);
    }

    function bumpShared(){
      const c = lsGet(kDemoCounters(), null);
      if(!c) return;
      c.addShared = (c.addShared||0) + 1;
      lsSet(kDemoCounters(), c);
    }

    /* =========================
      BLOK 19 ‚Äî RESULT ENGINE (DEMO)
    ========================== */
    function computeResultFor(user){
      const dayKey = getWibDateKey();
      const seedStr = `${CONFIG.PUBLIC_SALT}|${dayKey}|${user}`;
      const seed = cyrb128(seedStr);
      const rng = sfc32(seed[0], seed[1], seed[2], seed[3]);

      const rTier = rng();
      const tier = pickTier(rTier);

      const rAmount = rng();
      const amount = pickAmount(rAmount, tier.min, tier.max, CONFIG.AMOUNT_STEP);

      // extra: "rarity note"
      let note = "Umum";
      const p = tier.p;
      if(p <= 0.01) note = "Rare";
      else if(p <= 0.04) note = "Jarang";
      else if(p <= 0.10) note = "Menengah";
      else if(p <= 0.25) note = "Sering";

      // commit hash (visual confidence)
      const commit = shortHash(`${CONFIG.PUBLIC_SALT}|${dayKey}`);

      return { dayKey, tierLabel: tier.label, amount, note, commit };
    }

    function shortHash(str){
      const s = cyrb128(str);
      // hex 8 chars
      return (s[0]>>>0).toString(16).padStart(8,"0").slice(0,8).toUpperCase();
    }

    /* =========================
      BLOK 20 ‚Äî CONFETTI (MINI RINGAN)
    ========================== */
    const confetti = (() => {
      const cv = $("#confetti");
      const ctx = cv.getContext("2d");
      let W=0,H=0, particles=[], raf=null, alive=false;

      function resize(){
        const r = cv.getBoundingClientRect();
        cv.width = Math.max(1, Math.floor(r.width * devicePixelRatio));
        cv.height= Math.max(1, Math.floor(r.height* devicePixelRatio));
        W=cv.width; H=cv.height;
      }
      window.addEventListener("resize", resize, { passive:true });

      function spawn(n=80){
        particles = [];
        for(let i=0;i<n;i++){
          particles.push({
            x: Math.random()*W,
            y: -Math.random()*H*0.2,
            vx: (Math.random()-.5)*1.4*devicePixelRatio,
            vy: (Math.random()*2.2+1.2)*devicePixelRatio,
            r: (Math.random()*3+2.2)*devicePixelRatio,
            a: Math.random()*Math.PI
          });
        }
        alive = true;
      }

      function draw(){
        if(!alive) return;
        ctx.clearRect(0,0,W,H);
        // no fixed colors: generate by gradient-ish using alpha only (keep subtle)
        for(const p of particles){
          p.x += p.vx;
          p.y += p.vy;
          p.a += 0.08;
          p.vy *= 1.008;
          const alpha = Math.max(0, 1 - p.y/(H*1.05));
          ctx.globalAlpha = alpha*0.9;
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
          ctx.fillStyle = "rgba(255,255,255,.9)";
          ctx.fill();
        }
        ctx.globalAlpha = 1;
        particles = particles.filter(p => p.y < H + 40*devicePixelRatio);
        if(particles.length){
          raf = requestAnimationFrame(draw);
        }else{
          alive=false;
          $("#confetti").classList.remove("confettiOn");
        }
      }

      function boom(){
        resize();
        spawn(85);
        $("#confetti").classList.add("confettiOn");
        cancelAnimationFrame(raf);
        raf = requestAnimationFrame(draw);
        setTimeout(()=> $("#confetti").classList.remove("confettiOn"), 900);
      }

      return { boom };
    })();

    /* =========================
      BLOK 21 ‚Äî UI LOGIC
    ========================== */
    const el = {
      modeLabel: $("#modeLabel"),
      commitHash: $("#commitHash"),
      countdown: $("#countdown"),
      openedToday: $("#openedToday"),
      sharedToday: $("#sharedToday"),

      username: $("#username"),
      saveUser: $("#saveUser"),
      resetAll: $("#resetAll"),

      chances: $("#chances"),
      statusText: $("#statusText"),

      envelope: $("#envelope"),
      openBtn: $("#openBtn"),
      claimBtn: $("#claimBtn"),
      shareBtn: $("#shareBtn"),

      resultAmount: $("#resultAmount"),
      resultHint: $("#resultHint"),

      modalBack: $("#modalBack"),
      openTnc: $("#openTnc"),
      closeTnc: $("#closeTnc"),
      copyLink: $("#copyLink"),
    };

    let state = {
      user: "",
      dayKey: getWibDateKey(),
      opened: false,
      claimed: false,
      shared: false,
      result: null
    };

    function setEnabled(){
      const hasUser = !!state.user;
      el.envelope.classList.toggle("envDisabled", !hasUser || state.claimed);
      el.openBtn.disabled  = !hasUser || state.claimed;
      el.claimBtn.disabled = !hasUser || !state.opened || state.claimed;
      el.shareBtn.disabled = !hasUser || !state.claimed || state.shared;

      el.chances.textContent = state.user ? (state.claimed ? "0/1" : "1/1") : "‚Äî";
      el.statusText.textContent = !state.user ? "Butuh username"
        : state.claimed ? "Sudah claim hari ini"
        : state.opened ? "Hasil siap di-claim"
        : "Siap buka angpao";
    }

    function loadUser(){
      const u = lsGet(kUser(), "");
      if(u){
        state.user = u;
        el.username.value = u;
      }
    }

    function refreshDay(){
      const dk = getWibDateKey();
      if(dk !== state.dayKey){
        state.dayKey = dk;
        state.opened = false;
        state.claimed = false;
        state.shared = false;
        state.result = null;
        el.envelope.classList.remove("envOpen");
        el.resultAmount.textContent = "Rp‚Äî";
        el.resultHint.textContent = "Klik ‚ÄúBuka Angpao‚Äù untuk melihat hasil. Setelah itu kamu bisa claim freebet.";
        initDemoCounters();
        updateCountersUI();
        updateCommitHashUI();
        loadClaimFlags();
        setEnabled();
      }
    }

    function loadClaimFlags(){
      if(!state.user) return;
      const claim = lsGet(kClaim(state.user), null);
      state.claimed = !!claim;

      const share = lsGet(kShare(state.user), null);
      state.shared = !!share;

      if(state.claimed){
        // Show claimed result
        state.result = claim;
        state.opened = true;
        el.envelope.classList.add("envOpen");
        el.resultAmount.textContent = "Rp" + fmtIDR(claim.amount);
        el.resultHint.textContent = `Status: sudah claim ‚Ä¢ Tier: ${claim.tierLabel} ‚Ä¢ Masa aktif: 24 jam`;
      }else{
        state.opened = false;
        state.result = null;
        el.envelope.classList.remove("envOpen");
      }
    }

    function updateCountdown(){
      const ms = getNextResetMs();
      const s = Math.max(0, Math.floor(ms/1000));
      const h = String(Math.floor(s/3600)).padStart(2,"0");
      const m = String(Math.floor((s%3600)/60)).padStart(2,"0");
      const sec = String(s%60).padStart(2,"0");
      el.countdown.textContent = `${h}:${m}:${sec}`;
    }

    function updateCountersUI(){
      const c = getCounters();
      el.openedToday.textContent = fmtIDR(c.opened);
      el.sharedToday.textContent = fmtIDR(c.shared);
    }

    function updateCommitHashUI(){
      const dayKey = getWibDateKey();
      el.commitHash.textContent = shortHash(`${CONFIG.PUBLIC_SALT}|${dayKey}`);
    }

    function openAngpao(){
      if(!state.user) return toast("Isi dulu username.");
      if(state.claimed) return toast("Kamu sudah claim hari ini.");
      if(state.opened) return toast("Hasil sudah terbuka. Silakan claim.");

      state.result = computeResultFor(state.user);
      state.opened = true;

      el.envelope.classList.add("envOpen");
      el.resultAmount.textContent = "Rp" + fmtIDR(state.result.amount);
      el.resultHint.textContent = `${state.result.note} ‚Ä¢ ${state.result.tierLabel} ‚Ä¢ Claim dalam 24 jam.`;

      bumpOpened();
      updateCountersUI();
      confetti.boom();
      toast("Angpao terbuka! Claim untuk mengunci hadiah.");
      setEnabled();
    }

    function claim(){
      if(!state.user) return toast("Isi dulu username.");
      if(!state.opened || !state.result) return toast("Buka angpao dulu.");
      if(state.claimed) return toast("Sudah claim.");

      // lock claim (DEMO): store result per user per day
      const payload = {
        dayKey: getWibDateKey(),
        user: state.user,
        amount: state.result.amount,
        tierLabel: state.result.tierLabel,
        claimedAt: Date.now(),
        expiresAt: Date.now() + CONFIG.CLAIM_TTL_HOURS*60*60*1000
      };
      lsSet(kClaim(state.user), payload);
      state.claimed = true;

      toast("Freebet berhasil di-claim.");
      setEnabled();
    }

    function shareWA(){
      if(!state.user) return toast("Username belum ada.");
      if(!state.claimed) return toast("Claim dulu sebelum share.");
      if(state.shared) return toast("Kamu sudah share hari ini.");

      const claim = lsGet(kClaim(state.user), null);
      if(!claim) return toast("Data claim tidak ditemukan.");

      const url = location.href.split("#")[0];
      const text =
        `Aku baru dapet Angpao Keberuntungan 2026 üßß\n` +
        `Freebet: Rp${fmtIDR(claim.amount)}\n` +
        `Ikutan buka angpao hari ini: ${url}`;

      const wa = `https://wa.me/?text=${encodeURIComponent(text)}`;
      window.open(wa, "_blank", "noopener,noreferrer");

      // DEMO: mark as shared once/day
      lsSet(kShare(state.user), { sharedAt: Date.now() });
      state.shared = true;

      bumpShared();
      updateCountersUI();
      toast("Link WhatsApp dibuka. Terima kasih sudah membagikan!");
      setEnabled();
    }

    function saveUser(){
      const u = (el.username.value || "").trim();
      if(u.length < 3) return toast("Username minimal 3 karakter.");
      // no spaces
      const safe = u.replace(/\s+/g,"");
      state.user = safe;
      el.username.value = safe;
      lsSet(kUser(), safe);
      loadClaimFlags();
      toast("Username tersimpan.");
      setEnabled();
    }

    function resetDemo(){
      // wipe all related localStorage (demo only)
      const keys = [];
      for(let i=0;i<localStorage.length;i++){
        const k = localStorage.key(i);
        if(k && k.startsWith("angpao2026:")) keys.push(k);
      }
      keys.forEach(k => localStorage.removeItem(k));
      state.user = "";
      el.username.value = "";
      state.opened=false; state.claimed=false; state.shared=false; state.result=null;
      el.envelope.classList.remove("envOpen");
      el.resultAmount.textContent = "Rp‚Äî";
      el.resultHint.textContent = "Klik ‚ÄúBuka Angpao‚Äù untuk melihat hasil. Setelah itu kamu bisa claim freebet.";
      initDemoCounters();
      updateCountersUI();
      updateCommitHashUI();
      toast("Reset demo selesai.");
      setEnabled();
    }

    /* =========================
      BLOK 22 ‚Äî EVENTS
    ========================== */
    el.openBtn.addEventListener("click", openAngpao);
    el.claimBtn.addEventListener("click", claim);
    el.shareBtn.addEventListener("click", shareWA);
    el.saveUser.addEventListener("click", saveUser);
    el.resetAll.addEventListener("click", resetDemo);

    el.envelope.addEventListener("click", () => {
      if(el.openBtn.disabled) return;
      openAngpao();
    });
    el.envelope.addEventListener("keydown", (e) => {
      if(e.key === "Enter" || e.key === " "){
        e.preventDefault();
        if(!el.openBtn.disabled) openAngpao();
      }
    });

    // Modal TNC
    el.openTnc.addEventListener("click", () => el.modalBack.classList.add("show"));
    el.closeTnc.addEventListener("click", () => el.modalBack.classList.remove("show"));
    el.modalBack.addEventListener("click", (e) => {
      if(e.target === el.modalBack) el.modalBack.classList.remove("show");
    });

    // Copy link
    el.copyLink.addEventListener("click", async () => {
      try{
        await navigator.clipboard.writeText(location.href.split("#")[0]);
        toast("Link event berhasil disalin.");
      }catch{
        toast("Gagal copy. Silakan copy manual dari address bar.");
      }
    });

    /* =========================
      BLOK 23 ‚Äî INIT + TICK
    ========================== */
    function tick(){
      refreshDay();
      updateCountdown();
      requestAnimationFrame(tick);
    }

    function init(){
      el.modeLabel.textContent = CONFIG.MODE;
      initDemoCounters();
      updateCountersUI();
      updateCommitHashUI();
      loadUser();
      loadClaimFlags();
      setEnabled();
      tick();
    }

    init();
  </script>
</body>
</html>
